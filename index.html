<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aplicaci√≥n de gesti√≥n patrimonial integral para administrar finanzas, propiedades e inversiones">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Patrimonio">
    <title>Gesti√≥n Patrimonial</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados */
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .nav-item {
            cursor: pointer;
            transition: all 0.3s;
        }
        .nav-item:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        .nav-item.active {
            background-color: rgba(59, 130, 246, 0.2);
            border-left: 4px solid #3b82f6;
        }
        /* Estilos para categor√≠as colapsables */
        .nav-category-header {
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
        }
        .nav-category-header:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        .nav-category-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .nav-category-content.collapsed {
            max-height: 0;
        }
        .chevron {
            transition: transform 0.3s;
        }
        .chevron.collapsed {
            transform: rotate(-90deg);
        }
        /* Estilos para notificaciones toast */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }
        .toast {
            min-width: 300px;
            max-width: 500px;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
            pointer-events: auto;
            background: white;
        }
        .toast.success {
            border-left: 4px solid #10b981;
        }
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        .toast.warning {
            border-left: 4px solid #f59e0b;
        }
        .toast.info {
            border-left: 4px solid #3b82f6;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        .toast.hiding {
            animation: slideOut 0.3s ease-in forwards;
        }
        /* Estilos para botones de acci√≥n en tarjetas */
        .action-buttons {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }
        .action-buttons button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            font-size: 18px;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }
        .action-buttons button:hover {
            background-color: rgba(0, 0, 0, 0.05);
            transform: scale(1.1);
        }
        /* Variante para botones en esquina inferior */
        .action-buttons-bottom {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }
        .action-buttons-bottom button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            font-size: 18px;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }
        .action-buttons-bottom button:hover {
            background-color: rgba(0, 0, 0, 0.05);
            transform: scale(1.1);
        }
        /* Men√∫ m√≥vil */
        .mobile-menu-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }
        .mobile-menu-overlay.active {
            display: block;
        }
        @media (max-width: 768px) {
            aside {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100%;
                z-index: 50;
                transition: left 0.3s ease-in-out;
            }
            aside.mobile-open {
                left: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Contenedor de notificaciones toast -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- Bot√≥n hamburguesa (visible solo en m√≥viles) -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 left-4 z-30 bg-white p-3 rounded-lg shadow-lg" onclick="toggleMobileMenu()">
        <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    
    <!-- Overlay para cerrar men√∫ en m√≥vil -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay" onclick="toggleMobileMenu()"></div>
    
    <!-- Contenedor principal -->
    <div class="flex h-screen">
        <!-- Barra lateral de navegaci√≥n -->
        <aside id="mobile-sidebar" class="w-64 bg-white shadow-lg">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-gray-800">Gesti√≥n Patrimonial</h1>
            </div>
            
            <nav class="mt-6">
                <!-- Navegaci√≥n principal -->
                <div class="px-4 space-y-2">
                    <div class="nav-item active px-4 py-3 text-gray-700 rounded" onclick="showSection('inicio', event)">
                        <span class="text-lg">üè† Inicio</span>
                    </div>
                    
                    <!-- Categor√≠a Gesti√≥n -->
                    <div class="mt-4">
                        <div class="nav-category-header px-4 py-2 rounded flex justify-between items-center" onclick="toggleCategory('gestion')">
                            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Gesti√≥n</h3>
                            <svg class="w-4 h-4 text-gray-500 chevron" id="chevron-gestion" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        <div class="nav-category-content mt-2 space-y-1" id="category-gestion">
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('promociones', event)">
                                <span>üè¢ Promociones</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('inmuebles', event)">
                                <span>üèòÔ∏è Inmuebles</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('seguros', event)">
                                <span>üõ°Ô∏è Seguros</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('garantias', event)">
                                <span>üîß Garant√≠as</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Categor√≠a Operaciones -->
                    <div class="mt-4">
                        <div class="nav-category-header px-4 py-2 rounded flex justify-between items-center" onclick="toggleCategory('operaciones')">
                            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Operaciones</h3>
                            <svg class="w-4 h-4 text-gray-500 chevron" id="chevron-operaciones" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        <div class="nav-category-content mt-2 space-y-1" id="category-operaciones">
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('ventas', event)">
                                <span>üí∞ Ventas</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('alquileres', event)">
                                <span>üîë Alquileres</span>
                            </div>
                        </div>
                    </div>

                    <!-- Categor√≠a Finanzas -->
                    <div class="mt-4">
                        <div class="nav-category-header px-4 py-2 rounded flex justify-between items-center" onclick="toggleCategory('finanzas')">
                            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Finanzas</h3>
                            <svg class="w-4 h-4 text-gray-500 chevron" id="chevron-finanzas" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        <div class="nav-category-content mt-2 space-y-1" id="category-finanzas">
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('movimientos', event)">
                                <span>üìä Movimientos</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('cuentas', event)">
                                <span>üè¶ Cuentas Bancarias</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('categorias', event)">
                                <span>üè∑Ô∏è Categor√≠as</span>
                            </div>
                        </div>
                    </div>

                    <!-- Categor√≠a Referencias -->
                    <div class="mt-4">
                        <div class="nav-category-header px-4 py-2 rounded flex justify-between items-center" onclick="toggleCategory('referencias')">
                            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Referencias</h3>
                            <svg class="w-4 h-4 text-gray-500 chevron" id="chevron-referencias" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        <div class="nav-category-content mt-2 space-y-1" id="category-referencias">
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('comunidades', event)">
                                <span>üë• Comunidades</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('eventos', event)">
                                <span>üìÖ Eventos</span>
                            </div>
                        </div>
                    </div>

                    <!-- Categor√≠a Datos -->
                    <div class="mt-4">
                        <div class="nav-category-header px-4 py-2 rounded flex justify-between items-center" onclick="toggleCategory('datos')">
                            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Datos</h3>
                            <svg class="w-4 h-4 text-gray-500 chevron" id="chevron-datos" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        <div class="nav-category-content mt-2 space-y-1" id="category-datos">
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('exportar', event)">
                                <span>üíæ Exportar</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('importar', event)">
                                <span>üì• Importar</span>
                            </div>
                            <div class="nav-item px-4 py-3 text-gray-700 rounded" onclick="showSection('datos-prueba', event)">
                                <span>üé≤ Datos de Prueba</span>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- √Årea de contenido principal -->
        <main class="flex-1 overflow-y-auto pt-16 md:pt-0">
            <!-- Secci√≥n Inicio -->
            <section id="inicio" class="section active p-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Panel de Gesti√≥n</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Tarjetas de resumen -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-gray-500 text-sm font-semibold">Total Inmuebles</h3>
                        <p class="text-3xl font-bold text-blue-600 mt-2" id="totalInmuebles">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-gray-500 text-sm font-semibold">Alquileres Activos</h3>
                        <p class="text-3xl font-bold text-green-600 mt-2" id="totalAlquileres">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-gray-500 text-sm font-semibold">Incidencias Abiertas</h3>
                        <p class="text-3xl font-bold text-red-600 mt-2" id="totalIncidencias">0</p>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">√öltimos Movimientos</h3>
                    <div id="ultimosMovimientos">
                        <p class="text-gray-500">No hay movimientos registrados</p>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Promociones -->
            <section id="promociones" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Promociones</h2>
                    <button onclick="mostrarFormPromocion()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nueva Promoci√≥n
                    </button>
                </div>
                <div id="listaPromociones" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Las promociones se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Inmuebles -->
            <section id="inmuebles" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Inmuebles</h2>
                    <button onclick="mostrarFormInmueble()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nuevo Inmueble
                    </button>
                </div>
                <div id="listaInmuebles" class="space-y-4">
                    <!-- Los inmuebles se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Seguros -->
            <section id="seguros" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Seguros</h2>
                    <button onclick="mostrarFormSeguro()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nuevo Seguro
                    </button>
                </div>
                <div id="listaSeguros" class="space-y-4">
                    <!-- Los seguros se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Garant√≠as -->
            <section id="garantias" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Garant√≠as</h2>
                    <button onclick="mostrarFormGarantia()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nueva Garant√≠a
                    </button>
                </div>
                <div id="listaGarantias" class="space-y-4">
                    <!-- Las garant√≠as se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Alquileres -->
            <section id="alquileres" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Alquileres</h2>
                    <button onclick="mostrarFormAlquiler()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nuevo Alquiler
                    </button>
                </div>
                <div id="listaAlquileres" class="space-y-4">
                    <!-- Los alquileres se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Ventas -->
            <section id="ventas" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Ventas</h2>
                    <button onclick="mostrarFormVenta()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nueva Venta
                    </button>
                </div>
                <div id="listaVentas" class="space-y-4">
                    <!-- Las ventas se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Movimientos -->
            <section id="movimientos" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Movimientos Financieros</h2>
                    <button onclick="mostrarFormMovimiento()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nuevo Movimiento
                    </button>
                </div>
                <div id="listaMovimientos" class="bg-white rounded-lg shadow overflow-hidden">
                    <!-- Los movimientos se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Cuentas Bancarias -->
            <section id="cuentas" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Cuentas Bancarias</h2>
                    <button onclick="mostrarFormCuenta()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nueva Cuenta
                    </button>
                </div>
                <div id="listaCuentas" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Las cuentas se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Categor√≠as -->
            <section id="categorias" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Categor√≠as y Subcategor√≠as</h2>
                    <button onclick="mostrarFormCategoria()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nueva Categor√≠a
                    </button>
                </div>
                <div id="listaCategorias" class="space-y-4">
                    <!-- Las categor√≠as se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Comunidades -->
            <section id="comunidades" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Comunidades de Propietarios</h2>
                    <button onclick="mostrarFormComunidad()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nueva Comunidad
                    </button>
                </div>
                <div id="listaComunidades" class="space-y-4">
                    <!-- Las comunidades se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Eventos -->
            <section id="eventos" class="section p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Eventos y Calendario</h2>
                    <button onclick="mostrarFormEvento()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        + Nuevo Evento
                    </button>
                </div>
                <div id="listaEventos" class="space-y-4">
                    <!-- Los eventos se cargar√°n aqu√≠ -->
                </div>
            </section>

            <!-- Secci√≥n Exportar -->
            <section id="exportar" class="section p-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Exportar Datos</h2>
                <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Descargar Copia de Seguridad</h3>
                        <p class="text-gray-600 mb-4">
                            Exporta todos los datos de la aplicaci√≥n a un archivo JSON. Este archivo incluye todas las promociones, 
                            inmuebles, alquileres, movimientos, cuentas y dem√°s informaci√≥n almacenada en tu navegador.
                        </p>
                        <p class="text-sm text-gray-500 mb-4">
                            üí° Utiliza esta funci√≥n para crear copias de seguridad regulares de tus datos o para transferir 
                            la informaci√≥n a otro dispositivo.
                        </p>
                    </div>
                    <button onclick="exportarBaseDatos()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-semibold flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Descargar Datos
                    </button>
                </div>
            </section>

            <!-- Secci√≥n Importar -->
            <section id="importar" class="section p-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Importar Datos</h2>
                <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Restaurar desde Archivo</h3>
                        <p class="text-gray-600 mb-4">
                            Importa datos desde un archivo JSON previamente exportado. Esta acci√≥n a√±adir√° los datos 
                            del archivo a tu base de datos actual.
                        </p>
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700">
                                        <strong>Advertencia:</strong> Los datos importados se a√±adir√°n a los existentes. 
                                        Si deseas reemplazar completamente tus datos, primero debes limpiar la base de datos manualmente 
                                        desde las herramientas de desarrollo del navegador.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <input type="file" id="archivoImportar" accept=".json" class="block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-lg file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100
                            cursor-pointer">
                        <button onclick="importarBaseDatos()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-semibold flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                            </svg>
                            Importar Datos
                        </button>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Datos de Prueba -->
            <section id="datos-prueba" class="section p-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Generar Datos de Prueba</h2>
                <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Crear Ejemplos para Probar la Aplicaci√≥n</h3>
                        <p class="text-gray-600 mb-4">
                            Genera autom√°ticamente 12 ejemplos de datos para cada m√≥dulo de la aplicaci√≥n. 
                            Esto te permitir√° probar todas las funcionalidades con datos realistas.
                        </p>
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-blue-700 mb-2">
                                        <strong>Se crear√°n 132 registros en total:</strong>
                                    </p>
                                    <ul class="text-sm text-blue-700 list-disc list-inside space-y-1">
                                        <li>12 Promociones en diferentes ciudades</li>
                                        <li>12 Inmuebles (pisos, √°ticos, chalets, villas, etc.)</li>
                                        <li>12 Cuentas Bancarias con diferentes bancos</li>
                                        <li>12 Categor√≠as (ingresos y gastos)</li>
                                        <li>12 Seguros vinculados a inmuebles</li>
                                        <li>12 Garant√≠as de electrodom√©sticos</li>
                                        <li>12 Alquileres activos con inquilinos</li>
                                        <li>12 Ventas de propiedades</li>
                                        <li>12 Movimientos financieros</li>
                                        <li>12 Comunidades de propietarios</li>
                                        <li>12 Eventos (vencimientos, renovaciones, etc.)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700">
                                        <strong>Nota:</strong> Los datos se a√±adir√°n a los existentes. Si ya tienes datos, 
                                        se sumar√°n a los nuevos. Puedes ejecutar esta funci√≥n varias veces si lo deseas.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button onclick="crearDatosDePrueba()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 font-semibold flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        Generar 12 Ejemplos de Cada M√≥dulo
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal gen√©rico para formularios -->
    <div id="modalGenerico" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center" style="z-index: 1000;">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 id="modalTitulo" class="text-2xl font-bold text-gray-800"></h3>
                <button onclick="cerrarModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="modalContenido">
                <!-- El contenido del formulario se cargar√° aqu√≠ -->
            </div>
        </div>
    </div>

    <!-- Modal de confirmaci√≥n para borrados -->
    <div id="modalConfirmacion" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center" style="z-index: 1000;">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex items-center mb-4">
                <div class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mr-4">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-semibold text-gray-900">Confirmar Eliminaci√≥n</h3>
                </div>
            </div>
            <div class="mb-6">
                <p id="mensajeConfirmacion" class="text-gray-700"></p>
            </div>
            <div class="flex gap-3 justify-end">
                <button onclick="cancelarConfirmacion()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium">
                    Cancelar
                </button>
                <button onclick="aceptarConfirmacion()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium">
                    Eliminar
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN DE INDEXEDDB
        // ============================================
        
        let db;
        const DB_NAME = 'GestionPatrimonial';
        const DB_VERSION = 1;

        // Inicializar base de datos
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => reject('Error al abrir la base de datos');

                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('Base de datos inicializada correctamente');
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    db = event.target.result;

                    // Tabla Promociones
                    if (!db.objectStoreNames.contains('promociones')) {
                        const promocionesStore = db.createObjectStore('promociones', { keyPath: 'id', autoIncrement: true });
                        promocionesStore.createIndex('nombre', 'nombre', { unique: false });
                    }

                    // Tabla Inmuebles
                    if (!db.objectStoreNames.contains('inmuebles')) {
                        const inmueblesStore = db.createObjectStore('inmuebles', { keyPath: 'id', autoIncrement: true });
                        inmueblesStore.createIndex('codigo', 'codigo', { unique: true });
                        inmueblesStore.createIndex('promocionId', 'promocionId', { unique: false });
                    }

                    // Tabla Alquileres
                    if (!db.objectStoreNames.contains('alquileres')) {
                        const alquileresStore = db.createObjectStore('alquileres', { keyPath: 'id', autoIncrement: true });
                        alquileresStore.createIndex('inmuebleId', 'inmuebleId', { unique: false });
                        alquileresStore.createIndex('estado', 'estado', { unique: false });
                    }

                    // Tabla Seguros
                    if (!db.objectStoreNames.contains('seguros')) {
                        const segurosStore = db.createObjectStore('seguros', { keyPath: 'id', autoIncrement: true });
                        segurosStore.createIndex('inmuebleId', 'inmuebleId', { unique: false });
                        segurosStore.createIndex('estado', 'estado', { unique: false });
                    }

                    // Tabla Garant√≠as
                    if (!db.objectStoreNames.contains('garantias')) {
                        const garantiasStore = db.createObjectStore('garantias', { keyPath: 'id', autoIncrement: true });
                        garantiasStore.createIndex('inmuebleId', 'inmuebleId', { unique: false });
                    }

                    // Tabla Ventas
                    if (!db.objectStoreNames.contains('ventas')) {
                        const ventasStore = db.createObjectStore('ventas', { keyPath: 'id', autoIncrement: true });
                        ventasStore.createIndex('inmuebleId', 'inmuebleId', { unique: false });
                    }

                    // Tabla Movimientos
                    if (!db.objectStoreNames.contains('movimientos')) {
                        const movimientosStore = db.createObjectStore('movimientos', { keyPath: 'id', autoIncrement: true });
                        movimientosStore.createIndex('fecha', 'fecha', { unique: false });
                        movimientosStore.createIndex('categoriaId', 'categoriaId', { unique: false });
                        movimientosStore.createIndex('cuentaId', 'cuentaId', { unique: false });
                    }

                    // Tabla Cuentas Bancarias
                    if (!db.objectStoreNames.contains('cuentas')) {
                        const cuentasStore = db.createObjectStore('cuentas', { keyPath: 'id', autoIncrement: true });
                        cuentasStore.createIndex('nombre', 'nombre', { unique: false });
                    }

                    // Tabla Categor√≠as
                    if (!db.objectStoreNames.contains('categorias')) {
                        const categoriasStore = db.createObjectStore('categorias', { keyPath: 'id', autoIncrement: true });
                        categoriasStore.createIndex('nombre', 'nombre', { unique: false });
                    }

                    // Tabla Subcategor√≠as
                    if (!db.objectStoreNames.contains('subcategorias')) {
                        const subcategoriasStore = db.createObjectStore('subcategorias', { keyPath: 'id', autoIncrement: true });
                        subcategoriasStore.createIndex('categoriaId', 'categoriaId', { unique: false });
                    }

                    // Tabla Comunidades
                    if (!db.objectStoreNames.contains('comunidades')) {
                        const comunidadesStore = db.createObjectStore('comunidades', { keyPath: 'id', autoIncrement: true });
                        comunidadesStore.createIndex('nombre', 'nombre', { unique: false });
                    }

                    // Tabla Eventos
                    if (!db.objectStoreNames.contains('eventos')) {
                        const eventosStore = db.createObjectStore('eventos', { keyPath: 'id', autoIncrement: true });
                        eventosStore.createIndex('fecha', 'fecha', { unique: false });
                        eventosStore.createIndex('tipo', 'tipo', { unique: false });
                    }
                };
            });
        }

        // ============================================
        // FUNCIONES CRUD GEN√âRICAS
        // ============================================

        // Agregar registro
        function agregarRegistro(tabla, datos) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([tabla], 'readwrite');
                const store = transaction.objectStore(tabla);
                const request = store.add(datos);

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject('Error al agregar registro');
            });
        }

        // Obtener todos los registros
        function obtenerTodos(tabla) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([tabla], 'readonly');
                const store = transaction.objectStore(tabla);
                const request = store.getAll();

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject('Error al obtener registros');
            });
        }

        // Obtener un registro por ID
        function obtenerPorId(tabla, id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([tabla], 'readonly');
                const store = transaction.objectStore(tabla);
                const request = store.get(id);

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject('Error al obtener registro');
            });
        }

        // Actualizar registro
        function actualizarRegistro(tabla, datos) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([tabla], 'readwrite');
                const store = transaction.objectStore(tabla);
                const request = store.put(datos);

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject('Error al actualizar registro');
            });
        }

        // Eliminar registro
        function eliminarRegistro(tabla, id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([tabla], 'readwrite');
                const store = transaction.objectStore(tabla);
                const request = store.delete(id);

                request.onsuccess = () => resolve();
                request.onerror = () => reject('Error al eliminar registro');
            });
        }

        // ============================================
        // SISTEMA DE NOTIFICACIONES TOAST
        // ============================================

        /**
         * Muestra una notificaci√≥n toast moderna
         * @param {string} mensaje - El mensaje a mostrar
         * @param {string} tipo - Tipo: 'success', 'error', 'warning', 'info'
         * @param {number} duracion - Duraci√≥n en ms (por defecto 3000)
         */
        function mostrarNotificacion(mensaje, tipo = 'info', duracion = 3000) {
            const container = document.getElementById('toast-container');
            
            // Crear el elemento toast
            const toast = document.createElement('div');
            toast.className = `toast ${tipo}`;
            
            // Iconos seg√∫n el tipo
            const iconos = {
                success: `<svg class="w-6 h-6 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`,
                error: `<svg class="w-6 h-6 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`,
                warning: `<svg class="w-6 h-6 text-yellow-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>`,
                info: `<svg class="w-6 h-6 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`
            };
            
            toast.innerHTML = `
                ${iconos[tipo] || iconos.info}
                <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900">${mensaje}</p>
                </div>
                <button onclick="this.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto-eliminar despu√©s de la duraci√≥n especificada
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            }, duracion);
        }

        // ============================================
        // MODAL DE CONFIRMACI√ìN
        // ============================================

        let resolveConfirmacion = null;

        /**
         * Muestra un modal de confirmaci√≥n elegante
         * @param {string} mensaje - El mensaje a mostrar
         * @returns {Promise<boolean>} - true si acepta, false si cancela
         */
        function mostrarConfirmacion(mensaje) {
            return new Promise((resolve) => {
                resolveConfirmacion = resolve;
                document.getElementById('mensajeConfirmacion').textContent = mensaje;
                const modal = document.getElementById('modalConfirmacion');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            });
        }

        function aceptarConfirmacion() {
            const modal = document.getElementById('modalConfirmacion');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            if (resolveConfirmacion) {
                resolveConfirmacion(true);
                resolveConfirmacion = null;
            }
        }

        function cancelarConfirmacion() {
            const modal = document.getElementById('modalConfirmacion');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            if (resolveConfirmacion) {
                resolveConfirmacion(false);
                resolveConfirmacion = null;
            }
        }

        // ============================================
        // NAVEGACI√ìN ENTRE SECCIONES
        // ============================================

        // Funci√≥n para abrir/cerrar men√∫ m√≥vil
        function toggleMobileMenu() {
            const sidebar = document.getElementById('mobile-sidebar');
            const overlay = document.getElementById('mobile-menu-overlay');
            
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        function showSection(sectionId, event) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Mostrar la secci√≥n seleccionada
            document.getElementById(sectionId).classList.add('active');

            // Cerrar men√∫ m√≥vil al seleccionar una secci√≥n
            if (window.innerWidth < 768) {
                toggleMobileMenu();
            }

            // Actualizar navegaci√≥n activa
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Si hay un evento (click del usuario), actualizar el elemento activo
            if (event && event.target) {
                const navItem = event.target.closest('.nav-item');
                if (navItem) {
                    navItem.classList.add('active');
                }
            } else {
                // Si no hay evento (llamada program√°tica), buscar el nav-item por el sectionId
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    if (item.getAttribute('onclick')?.includes(sectionId)) {
                        item.classList.add('active');
                    }
                });
            }

            // Cargar datos de la secci√≥n
            cargarDatosSeccion(sectionId);
        }

        // ============================================
        // FUNCIONES DE NAVEGACI√ìN COLAPSABLE
        // ============================================

        /**
         * Alterna el estado colapsado/expandido de una categor√≠a del men√∫
         */
        function toggleCategory(categoryName) {
            const content = document.getElementById(`category-${categoryName}`);
            const chevron = document.getElementById(`chevron-${categoryName}`);
            
            if (content && chevron) {
                content.classList.toggle('collapsed');
                chevron.classList.toggle('collapsed');
            }
        }

        // ============================================
        // FUNCIONES DE MODAL
        // ============================================

        function abrirModal(titulo, contenido) {
            document.getElementById('modalTitulo').textContent = titulo;
            document.getElementById('modalContenido').innerHTML = contenido;
            document.getElementById('modalGenerico').classList.remove('hidden');
            document.getElementById('modalGenerico').classList.add('flex');
        }

        function cerrarModal() {
            document.getElementById('modalGenerico').classList.add('hidden');
            document.getElementById('modalGenerico').classList.remove('flex');
        }

        // ============================================
        // FUNCIONES PARA MOSTRAR FORMULARIOS
        // ============================================

        function mostrarFormPromocion() {
            const contenido = `
                <form id="formPromocion" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Nombre de la Promoci√≥n</label>
                        <input type="text" name="nombre" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Direcci√≥n</label>
                        <input type="text" name="direccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Descripci√≥n</label>
                        <textarea name="descripcion" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nueva Promoci√≥n', contenido);
            document.getElementById('formPromocion').onsubmit = guardarPromocion;
        }

        async function mostrarFormInmueble() {
            const promociones = await obtenerTodos('promociones');
            const opcionesPromociones = promociones.map(p => 
                `<option value="${p.id}">${p.nombre}</option>`
            ).join('');

            const contenido = `
                <form id="formInmueble" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">C√≥digo del Inmueble *</label>
                            <input type="text" name="codigo" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Promoci√≥n</label>
                            <select name="promocionId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">Sin promoci√≥n</option>
                                ${opcionesPromociones}
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Direcci√≥n Completa</label>
                        <input type="text" name="direccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">M2 Vivienda</label>
                            <input type="number" step="0.01" name="m2Vivienda" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">M2 Terraza</label>
                            <input type="number" step="0.01" name="m2Terraza" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">N¬∫ Finca</label>
                            <input type="text" name="numFinca" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Referencia Catastral</label>
                            <input type="text" name="referenciaCatastral" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tipo</label>
                            <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="Piso">Piso</option>
                                <option value="Casa">Casa</option>
                                <option value="Local">Local</option>
                                <option value="Garaje">Garaje</option>
                                <option value="Trastero">Trastero</option>
                                <option value="Terreno">Terreno</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Valor de Adquisici√≥n (‚Ç¨)</label>
                            <input type="number" step="0.01" name="valorAdquisicion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">% Propiedad</label>
                            <input type="number" step="0.01" name="porcentajePropiedad" value="100" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Titular</label>
                        <input type="text" name="titular" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nuevo Inmueble', contenido);
            document.getElementById('formInmueble').onsubmit = guardarInmueble;
        }

        async function mostrarFormSeguro() {
            const inmuebles = await obtenerTodos('inmuebles');
            const opcionesInmuebles = inmuebles.map(i => 
                `<option value="${i.id}">${i.codigo} - ${i.direccion || ''}</option>`
            ).join('');

            const contenido = `
                <form id="formSeguro" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">N√∫mero de P√≥liza *</label>
                            <input type="text" name="numeroPoliza" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Estado</label>
                            <select name="estado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="Activo">Activo</option>
                                <option value="Cerrado">Cerrado</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Aseguradora</label>
                            <input type="text" name="aseguradora" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Corredur√≠a</label>
                            <input type="text" name="correduria" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha Contrataci√≥n</label>
                            <input type="date" name="fechaContratacion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Precio (‚Ç¨)</label>
                            <input type="number" step="0.01" name="precio" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Inmueble</label>
                        <select name="inmuebleId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="">No vinculado</option>
                            ${opcionesInmuebles}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tomador</label>
                        <input type="text" name="tomador" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nuevo Seguro', contenido);
            document.getElementById('formSeguro').onsubmit = guardarSeguro;
        }

        async function mostrarFormGarantia() {
            const inmuebles = await obtenerTodos('inmuebles');
            const opcionesInmuebles = inmuebles.map(i => 
                `<option value="${i.id}">${i.codigo} - ${i.direccion || ''}</option>`
            ).join('');

            const contenido = `
                <form id="formGarantia" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Electrodom√©stico/Modelo *</label>
                            <input type="text" name="electrodomestico" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Proveedor</label>
                            <input type="text" name="proveedor" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha de Compra</label>
                            <input type="date" name="fechaCompra" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Precio (‚Ç¨)</label>
                            <input type="number" step="0.01" name="precio" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Inmueble</label>
                        <select name="inmuebleId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="">No vinculado</option>
                            ${opcionesInmuebles}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Inquilinos</label>
                        <input type="text" name="inquilinos" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nueva Garant√≠a', contenido);
            document.getElementById('formGarantia').onsubmit = guardarGarantia;
        }

        async function mostrarFormAlquiler() {
            const inmuebles = await obtenerTodos('inmuebles');
            const opcionesInmuebles = inmuebles.map(i => 
                `<option value="${i.id}">${i.codigo} - ${i.direccion || ''}</option>`
            ).join('');

            const contenido = `
                <form id="formAlquiler" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nombre del Inquilino *</label>
                            <input type="text" name="nombreInquilino" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">DNI</label>
                            <input type="text" name="dniInquilino" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Inmueble *</label>
                        <select name="inmuebleId" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="">Seleccionar inmueble</option>
                            ${opcionesInmuebles}
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Precio Inicial (‚Ç¨) *</label>
                            <input type="number" step="0.01" name="precioInicial" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Precio Actual (‚Ç¨)</label>
                            <input type="number" step="0.01" name="precioActual" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha Inicio</label>
                            <input type="date" name="fechaInicio" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Pr√≥xima Renovaci√≥n</label>
                            <input type="date" name="proximaRenovacion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha Fin</label>
                            <input type="date" name="fechaFin" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Estado</label>
                        <select name="estado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="activo">Activo</option>
                            <option value="finalizado">Finalizado</option>
                            <option value="pendiente">Pendiente</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Documento</label>
                        <input type="text" name="documento" placeholder="URL o referencia al documento" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nuevo Alquiler', contenido);
            document.getElementById('formAlquiler').onsubmit = guardarAlquiler;
        }

        async function mostrarFormVenta() {
            const inmuebles = await obtenerTodos('inmuebles');
            const opcionesInmuebles = inmuebles.map(i => 
                `<option value="${i.id}">${i.codigo} - ${i.direccion || ''}</option>`
            ).join('');

            const contenido = `
                <form id="formVenta" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Inmueble *</label>
                        <select name="inmuebleId" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="">Seleccionar inmueble</option>
                            ${opcionesInmuebles}
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Comprador</label>
                            <input type="text" name="comprador" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">DNI Comprador</label>
                            <input type="text" name="dniComprador" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Precio de Venta (‚Ç¨) *</label>
                            <input type="number" step="0.01" name="precioVenta" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha de Venta</label>
                            <input type="date" name="fechaVenta" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Notar√≠a / N√∫m. Escritura</label>
                        <input type="text" name="notaria" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nueva Venta', contenido);
            document.getElementById('formVenta').onsubmit = guardarVenta;
        }

        async function mostrarFormMovimiento() {
            const cuentas = await obtenerTodos('cuentas');
            const categorias = await obtenerTodos('categorias');
            const inmuebles = await obtenerTodos('inmuebles');
            
            const opcionesCuentas = cuentas.map(c => 
                `<option value="${c.id}">${c.nombre}</option>`
            ).join('');
            
            const opcionesCategorias = categorias.map(c => 
                `<option value="${c.id}">${c.nombre}</option>`
            ).join('');
            
            const opcionesInmuebles = inmuebles.map(i => 
                `<option value="${i.id}">${i.codigo}</option>`
            ).join('');

            const contenido = `
                <form id="formMovimiento" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha *</label>
                            <input type="date" name="fecha" required value="${new Date().toISOString().split('T')[0]}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Importe (‚Ç¨) *</label>
                            <input type="number" step="0.01" name="importe" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <p class="text-xs text-gray-500 mt-1">Positivo para ingresos, negativo para gastos</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Descripci√≥n *</label>
                        <input type="text" name="descripcion" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Cuenta Bancaria</label>
                            <select name="cuentaId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">Sin cuenta</option>
                                ${opcionesCuentas}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Categor√≠a</label>
                            <select name="categoriaId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">Sin categor√≠a</option>
                                ${opcionesCategorias}
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Inmueble Vinculado</label>
                        <select name="inmuebleId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="">No vinculado</option>
                            ${opcionesInmuebles}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Etiquetas</label>
                        <input type="text" name="etiquetas" placeholder="Separadas por comas" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Notas</label>
                        <textarea name="notas" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nuevo Movimiento', contenido);
            document.getElementById('formMovimiento').onsubmit = guardarMovimiento;
        }

        async function mostrarFormCuenta() {
            const contenido = `
                <form id="formCuenta" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Nombre de la Cuenta *</label>
                        <input type="text" name="nombre" required placeholder="Ej: Banca March - Personal" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tipo de Cuenta</label>
                        <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="Corriente">Corriente</option>
                            <option value="Ahorro">Ahorro</option>
                            <option value="Efectivo">Efectivo</option>
                            <option value="Inversi√≥n">Inversi√≥n</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Saldo Inicial (‚Ç¨)</label>
                        <input type="number" step="0.01" name="saldoInicial" value="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">IBAN</label>
                        <input type="text" name="iban" placeholder="ES00 0000 0000 00 0000000000" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Entidad Bancaria</label>
                        <input type="text" name="entidad" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nueva Cuenta Bancaria', contenido);
            document.getElementById('formCuenta').onsubmit = guardarCuenta;
        }

        async function mostrarFormCategoria() {
            const contenido = `
                <form id="formCategoria" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Nombre de la Categor√≠a *</label>
                        <input type="text" name="nombre" required placeholder="Ej: Impuestos, Cobros, Gastos" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tipo</label>
                        <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="Ingreso">Ingreso</option>
                            <option value="Gasto">Gasto</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Color (opcional)</label>
                        <input type="color" name="color" value="#3b82f6" class="mt-1 block w-full h-10 rounded-md border-gray-300 shadow-sm p-1 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Descripci√≥n</label>
                        <textarea name="descripcion" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nueva Categor√≠a', contenido);
            document.getElementById('formCategoria').onsubmit = guardarCategoria;
        }

        async function mostrarFormComunidad() {
            const contenido = `
                <form id="formComunidad" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Nombre de la Comunidad *</label>
                        <input type="text" name="nombre" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">NIF/CIF</label>
                        <input type="text" name="nif" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Direcci√≥n</label>
                        <input type="text" name="direccion" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                        <input type="tel" name="telefono" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nueva Comunidad', contenido);
            document.getElementById('formComunidad').onsubmit = guardarComunidad;
        }

        async function mostrarFormEvento() {
            const inmuebles = await obtenerTodos('inmuebles');
            const opcionesInmuebles = inmuebles.map(i => 
                `<option value="${i.id}">${i.codigo} - ${i.direccion || ''}</option>`
            ).join('');

            const contenido = `
                <form id="formEvento" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha *</label>
                            <input type="date" name="fecha" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tipo</label>
                            <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="Adquisici√≥n">Adquisici√≥n</option>
                                <option value="Firma contrato alquiler">Firma contrato alquiler</option>
                                <option value="Renovaci√≥n alquiler">Renovaci√≥n alquiler</option>
                                <option value="Vencimiento seguro">Vencimiento seguro</option>
                                <option value="Junta comunidad">Junta comunidad</option>
                                <option value="Cerrar incidencia">Cerrar incidencia</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Descripci√≥n *</label>
                        <input type="text" name="descripcion" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Inmueble Relacionado</label>
                        <select name="inmuebleId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="">No vinculado</option>
                            ${opcionesInmuebles}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Importe (‚Ç¨)</label>
                        <input type="number" step="0.01" name="importe" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Guardar
                        </button>
                    </div>
                </form>
            `;
            abrirModal('Nuevo Evento', contenido);
            document.getElementById('formEvento').onsubmit = guardarEvento;
        }

        // ============================================
        // FUNCIONES PARA GUARDAR DATOS
        // ============================================

        async function guardarPromocion(e) {
            e.preventDefault();
            const id = document.getElementById('promocionId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                nombre: formData.get('nombre'),
                direccion: formData.get('direccion'),
                descripcion: formData.get('descripcion')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('promociones', datos);
                    mostrarNotificacion('Promoci√≥n actualizada correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('promociones', datos);
                    mostrarNotificacion('Promoci√≥n guardada correctamente', 'success');
                }
                cerrarModal();
                cargarPromociones();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar la promoci√≥n', 'error');
            }
        }

        async function guardarInmueble(e) {
            e.preventDefault();
            const id = document.getElementById('inmuebleId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                codigo: formData.get('codigo'),
                promocionId: formData.get('promocionId') || null,
                direccion: formData.get('direccion'),
                m2Vivienda: parseFloat(formData.get('m2Vivienda')) || 0,
                m2Terraza: parseFloat(formData.get('m2Terraza')) || 0,
                numFinca: formData.get('numFinca'),
                referenciaCatastral: formData.get('referenciaCatastral'),
                tipo: formData.get('tipo'),
                valorAdquisicion: parseFloat(formData.get('valorAdquisicion')) || 0,
                porcentajePropiedad: parseFloat(formData.get('porcentajePropiedad')) || 100,
                titular: formData.get('titular')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('inmuebles', datos);
                    mostrarNotificacion('Inmueble actualizado correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('inmuebles', datos);
                    mostrarNotificacion('Inmueble guardado correctamente', 'success');
                }
                cerrarModal();
                cargarInmuebles();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar el inmueble: ' + error, 'error');
            }
        }

        async function guardarSeguro(e) {
            e.preventDefault();
            const id = document.getElementById('seguroId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                numeroPoliza: formData.get('numeroPoliza'),
                estado: formData.get('estado'),
                aseguradora: formData.get('aseguradora'),
                correduria: formData.get('correduria'),
                fechaContratacion: formData.get('fechaContratacion'),
                precio: parseFloat(formData.get('precio')) || 0,
                inmuebleId: formData.get('inmuebleId') || null,
                tomador: formData.get('tomador')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('seguros', datos);
                    mostrarNotificacion('Seguro actualizado correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('seguros', datos);
                    mostrarNotificacion('Seguro guardado correctamente', 'success');
                }
                cerrarModal();
                cargarSeguros();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar el seguro', 'error');
            }
        }

        async function guardarGarantia(e) {
            e.preventDefault();
            const id = document.getElementById('garantiaId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                electrodomestico: formData.get('electrodomestico'),
                proveedor: formData.get('proveedor'),
                fechaCompra: formData.get('fechaCompra'),
                precio: parseFloat(formData.get('precio')) || 0,
                inmuebleId: formData.get('inmuebleId') || null,
                inquilinos: formData.get('inquilinos')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('garantias', datos);
                    mostrarNotificacion('Garant√≠a actualizada correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('garantias', datos);
                    mostrarNotificacion('Garant√≠a guardada correctamente', 'success');
                }
                cerrarModal();
                cargarGarantias();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar la garant√≠a', 'error');
            }
        }

        async function guardarAlquiler(e) {
            e.preventDefault();
            const id = document.getElementById('alquilerId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                nombreInquilino: formData.get('nombreInquilino'),
                dniInquilino: formData.get('dniInquilino'),
                inmuebleId: formData.get('inmuebleId'),
                precioInicial: parseFloat(formData.get('precioInicial')),
                precioActual: parseFloat(formData.get('precioActual')) || parseFloat(formData.get('precioInicial')),
                fechaInicio: formData.get('fechaInicio'),
                proximaRenovacion: formData.get('proximaRenovacion'),
                fechaFin: formData.get('fechaFin'),
                estado: formData.get('estado'),
                documento: formData.get('documento')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('alquileres', datos);
                    mostrarNotificacion('Alquiler actualizado correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('alquileres', datos);
                    mostrarNotificacion('Alquiler guardado correctamente', 'success');
                }
                cerrarModal();
                cargarAlquileres();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar el alquiler', 'error');
            }
        }

        async function guardarVenta(e) {
            e.preventDefault();
            const id = document.getElementById('ventaId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                inmuebleId: formData.get('inmuebleId'),
                comprador: formData.get('comprador'),
                dniComprador: formData.get('dniComprador'),
                precioVenta: parseFloat(formData.get('precioVenta')),
                fechaVenta: formData.get('fechaVenta'),
                notaria: formData.get('notaria')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('ventas', datos);
                    mostrarNotificacion('Venta actualizada correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('ventas', datos);
                    mostrarNotificacion('Venta guardada correctamente', 'success');
                }
                cerrarModal();
                cargarVentas();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar la venta', 'error');
            }
        }

        async function guardarMovimiento(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const datos = {
                fecha: formData.get('fecha'),
                descripcion: formData.get('descripcion'),
                importe: parseFloat(formData.get('importe')),
                cuentaId: formData.get('cuentaId') || null,
                categoriaId: formData.get('categoriaId') || null,
                inmuebleId: formData.get('inmuebleId') || null,
                etiquetas: formData.get('etiquetas'),
                notas: formData.get('notas'),
                fechaCreacion: new Date().toISOString()
            };

            try {
                await agregarRegistro('movimientos', datos);
                cerrarModal();
                cargarMovimientos();
                cargarDashboard();
                mostrarNotificacion('Movimiento guardado correctamente', 'success');
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar el movimiento', 'error');
            }
        }

        async function guardarCuenta(e) {
            e.preventDefault();
            const id = document.getElementById('cuentaId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                nombre: formData.get('nombre'),
                tipo: formData.get('tipo'),
                saldoInicial: parseFloat(formData.get('saldoInicial')) || 0,
                iban: formData.get('iban'),
                entidad: formData.get('entidad')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('cuentas', datos);
                    mostrarNotificacion('Cuenta actualizada correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('cuentas', datos);
                    mostrarNotificacion('Cuenta guardada correctamente', 'success');
                }
                cerrarModal();
                cargarCuentas();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar la cuenta');
            }
        }

        async function guardarCategoria(e) {
            e.preventDefault();
            const id = document.getElementById('categoriaId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                nombre: formData.get('nombre'),
                tipo: formData.get('tipo'),
                color: formData.get('color'),
                descripcion: formData.get('descripcion')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('categorias', datos);
                    mostrarNotificacion('Categor√≠a actualizada correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('categorias', datos);
                    mostrarNotificacion('Categor√≠a guardada correctamente', 'success');
                }
                cerrarModal();
                cargarCategorias();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar la categor√≠a');
            }
        }

        async function guardarComunidad(e) {
            e.preventDefault();
            const id = document.getElementById('comunidadId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                nombre: formData.get('nombre'),
                nif: formData.get('nif'),
                direccion: formData.get('direccion'),
                telefono: formData.get('telefono'),
                email: formData.get('email')
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('comunidades', datos);
                    mostrarNotificacion('Comunidad actualizada correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('comunidades', datos);
                    mostrarNotificacion('Comunidad guardada correctamente', 'success');
                }
                cerrarModal();
                cargarComunidades();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar la comunidad');
            }
        }

        async function guardarEvento(e) {
            e.preventDefault();
            const id = document.getElementById('eventoId')?.value;
            const formData = new FormData(e.target);
            const datos = {
                fecha: formData.get('fecha'),
                tipo: formData.get('tipo'),
                descripcion: formData.get('descripcion'),
                inmuebleId: formData.get('inmuebleId') || null,
                importe: parseFloat(formData.get('importe')) || 0
            };

            try {
                if (id) {
                    datos.id = parseInt(id);
                    await actualizarRegistro('eventos', datos);
                    mostrarNotificacion('Evento actualizado correctamente', 'success');
                } else {
                    datos.fechaCreacion = new Date().toISOString();
                    await agregarRegistro('eventos', datos);
                    mostrarNotificacion('Evento guardado correctamente', 'success');
                }
                cerrarModal();
                cargarEventos();
            } catch (error) {
                console.error(error);
                mostrarNotificacion('Error al guardar el evento');
            }
        }

        // ============================================
        // FUNCIONES PARA CARGAR DATOS
        // ============================================

        async function cargarDatosSeccion(seccion) {
            switch(seccion) {
                case 'inicio':
                    await cargarDashboard();
                    break;
                case 'promociones':
                    await cargarPromociones();
                    break;
                case 'inmuebles':
                    await cargarInmuebles();
                    break;
                case 'seguros':
                    await cargarSeguros();
                    break;
                case 'garantias':
                    await cargarGarantias();
                    break;
                case 'alquileres':
                    await cargarAlquileres();
                    break;
                case 'ventas':
                    await cargarVentas();
                    break;
                case 'movimientos':
                    await cargarMovimientos();
                    break;
                case 'cuentas':
                    await cargarCuentas();
                    break;
                case 'categorias':
                    await cargarCategorias();
                    break;
                case 'comunidades':
                    await cargarComunidades();
                    break;
                case 'eventos':
                    await cargarEventos();
                    break;
            }
        }

        async function cargarDashboard() {
            try {
                const inmuebles = await obtenerTodos('inmuebles');
                const alquileres = await obtenerTodos('alquileres');
                const movimientos = await obtenerTodos('movimientos');

                document.getElementById('totalInmuebles').textContent = inmuebles.length;
                document.getElementById('totalAlquileres').textContent = alquileres.filter(a => a.estado === 'activo').length;
                
                // Mostrar √∫ltimos movimientos
                const ultimosMovimientos = movimientos.slice(-5).reverse();
                const htmlMovimientos = ultimosMovimientos.length > 0 
                    ? ultimosMovimientos.map(m => `
                        <div class="border-b py-3">
                            <div class="flex justify-between">
                                <span class="font-medium">${m.descripcion}</span>
                                <span class="font-bold ${m.importe >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${m.importe >= 0 ? '+' : ''}${m.importe.toFixed(2)}‚Ç¨
                                </span>
                            </div>
                            <div class="text-sm text-gray-500">${new Date(m.fecha).toLocaleDateString()}</div>
                        </div>
                    `).join('')
                    : '<p class="text-gray-500">No hay movimientos registrados</p>';

                document.getElementById('ultimosMovimientos').innerHTML = htmlMovimientos;
            } catch (error) {
                console.error('Error al cargar dashboard:', error);
            }
        }

        async function cargarPromociones() {
            try {
                const promociones = await obtenerTodos('promociones');
                const container = document.getElementById('listaPromociones');
                
                if (promociones.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 col-span-full">No hay promociones registradas</p>';
                    return;
                }

                container.innerHTML = promociones.map(p => `
                    <div class="bg-white rounded-lg shadow p-6 relative">
                        <div class="action-buttons">
                            <button onclick="editarPromocion(${p.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="eliminarPromocion(${p.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${p.nombre}</h3>
                        <p class="text-gray-600 mb-2">${p.direccion || 'Sin direcci√≥n'}</p>
                        <p class="text-gray-500 text-sm">${p.descripcion || ''}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error al cargar promociones:', error);
            }
        }

        async function cargarInmuebles() {
            try {
                const inmuebles = await obtenerTodos('inmuebles');
                const promociones = await obtenerTodos('promociones');
                const container = document.getElementById('listaInmuebles');
                
                if (inmuebles.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay inmuebles registrados</p>';
                    return;
                }

                container.innerHTML = inmuebles.map(i => {
                    const promocion = promociones.find(p => p.id == i.promocionId);
                    return `
                        <div class="bg-white rounded-lg shadow p-6 relative">
                            <div class="action-buttons">
                                <button onclick="editarInmueble(${i.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="eliminarInmueble(${i.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                            <div class="mb-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <h3 class="text-xl font-bold text-gray-800">${i.codigo}</h3>
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${i.tipo}</span>
                                </div>
                                <p class="text-gray-600">${i.direccion || 'Sin direcci√≥n'}</p>
                                ${promocion ? `<p class="text-sm text-blue-600">Promoci√≥n: ${promocion.nombre}</p>` : ''}
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">M2 Vivienda:</span>
                                    <p class="font-medium">${i.m2Vivienda || 0} m¬≤</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">M2 Terraza:</span>
                                    <p class="font-medium">${i.m2Terraza || 0} m¬≤</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Valor Adq.:</span>
                                    <p class="font-medium">${i.valorAdquisicion?.toFixed(2) || '0.00'} ‚Ç¨</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Ref. Catastral:</span>
                                    <p class="font-medium text-xs">${i.referenciaCatastral || 'N/A'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar inmuebles:', error);
            }
        }

        async function cargarSeguros() {
            try {
                const seguros = await obtenerTodos('seguros');
                const inmuebles = await obtenerTodos('inmuebles');
                const container = document.getElementById('listaSeguros');
                
                if (seguros.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay seguros registrados</p>';
                    return;
                }

                container.innerHTML = seguros.map(s => {
                    const inmueble = inmuebles.find(i => i.id == s.inmuebleId);
                    const estadoColor = s.estado === 'Activo' ? 'green' : 'gray';
                    return `
                        <div class="bg-white rounded-lg shadow p-6 relative">
                            <div class="action-buttons">
                                <button onclick="editarSeguro(${s.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="eliminarSeguro(${s.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                            <div class="mb-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <h3 class="text-lg font-bold text-gray-800">P√≥liza: ${s.numeroPoliza}</h3>
                                    <span class="bg-${estadoColor}-100 text-${estadoColor}-800 text-xs px-2 py-1 rounded">${s.estado}</span>
                                </div>
                                <p class="text-gray-600">${s.aseguradora || 'Sin aseguradora'}</p>
                                ${inmueble ? `<p class="text-sm text-blue-600">Inmueble: ${inmueble.codigo}</p>` : ''}
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">Corredur√≠a:</span>
                                    <p class="font-medium">${s.correduria || 'N/A'}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Precio:</span>
                                    <p class="font-medium">${s.precio?.toFixed(2) || '0.00'} ‚Ç¨</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar seguros:', error);
            }
        }

        async function cargarGarantias() {
            try {
                const garantias = await obtenerTodos('garantias');
                const inmuebles = await obtenerTodos('inmuebles');
                const container = document.getElementById('listaGarantias');
                
                if (garantias.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay garant√≠as registradas</p>';
                    return;
                }

                container.innerHTML = garantias.map(g => {
                    const inmueble = inmuebles.find(i => i.id == g.inmuebleId);
                    return `
                        <div class="bg-white rounded-lg shadow p-6 relative">
                            <div class="action-buttons">
                                <button onclick="editarGarantia(${g.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="eliminarGarantia(${g.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">${g.electrodomestico}</h3>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">Proveedor:</span>
                                    <p class="font-medium">${g.proveedor || 'N/A'}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Precio:</span>
                                    <p class="font-medium">${g.precio?.toFixed(2) || '0.00'} ‚Ç¨</p>
                                </div>
                                ${inmueble ? `<div class="col-span-2"><span class="text-gray-500">Inmueble:</span><p class="font-medium">${inmueble.codigo}</p></div>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar garant√≠as:', error);
            }
        }

        async function cargarAlquileres() {
            try {
                const alquileres = await obtenerTodos('alquileres');
                const inmuebles = await obtenerTodos('inmuebles');
                const container = document.getElementById('listaAlquileres');
                
                if (alquileres.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay alquileres registrados</p>';
                    return;
                }

                container.innerHTML = alquileres.map(a => {
                    const inmueble = inmuebles.find(i => i.id == a.inmuebleId);
                    const estadoColor = a.estado === 'activo' ? 'green' : a.estado === 'finalizado' ? 'gray' : 'yellow';
                    return `
                        <div class="bg-white rounded-lg shadow p-6 relative">
                            <div class="action-buttons">
                                <button onclick="editarAlquiler(${a.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="eliminarAlquiler(${a.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                            <div class="mb-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <h3 class="text-lg font-bold text-gray-800">${a.nombreInquilino}</h3>
                                    <span class="bg-${estadoColor}-100 text-${estadoColor}-800 text-xs px-2 py-1 rounded capitalize">${a.estado}</span>
                                </div>
                                ${inmueble ? `<p class="text-gray-600">Inmueble: ${inmueble.codigo}</p>` : ''}
                                <p class="text-sm text-gray-500">DNI: ${a.dniInquilino || 'N/A'}</p>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">Precio Actual:</span>
                                    <p class="font-medium text-lg text-green-600">${a.precioActual?.toFixed(2) || '0.00'} ‚Ç¨</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Fecha Inicio:</span>
                                    <p class="font-medium">${a.fechaInicio ? new Date(a.fechaInicio).toLocaleDateString() : 'N/A'}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Pr√≥xima Renovaci√≥n:</span>
                                    <p class="font-medium">${a.proximaRenovacion ? new Date(a.proximaRenovacion).toLocaleDateString() : 'N/A'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar alquileres:', error);
            }
        }

        async function cargarVentas() {
            try {
                const ventas = await obtenerTodos('ventas');
                const inmuebles = await obtenerTodos('inmuebles');
                const container = document.getElementById('listaVentas');
                
                if (ventas.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay ventas registradas</p>';
                    return;
                }

                container.innerHTML = ventas.map(v => {
                    const inmueble = inmuebles.find(i => i.id == v.inmuebleId);
                    return `
                        <div class="bg-white rounded-lg shadow p-6 relative">
                            <div class="action-buttons">
                                <button onclick="editarVenta(${v.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="eliminarVenta(${v.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 mb-2">${inmueble ? inmueble.codigo : 'Inmueble no encontrado'}</h3>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">Comprador:</span>
                                    <p class="font-medium">${v.comprador || 'N/A'}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Precio de Venta:</span>
                                    <p class="font-medium text-lg text-green-600">${v.precioVenta?.toFixed(2) || '0.00'} ‚Ç¨</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Fecha:</span>
                                    <p class="font-medium">${v.fechaVenta ? new Date(v.fechaVenta).toLocaleDateString() : 'N/A'}</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Notar√≠a:</span>
                                    <p class="font-medium">${v.notaria || 'N/A'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar ventas:', error);
            }
        }

        async function cargarMovimientos() {
            try {
                const movimientos = await obtenerTodos('movimientos');
                const cuentas = await obtenerTodos('cuentas');
                const categorias = await obtenerTodos('categorias');
                const inmuebles = await obtenerTodos('inmuebles');
                const container = document.getElementById('listaMovimientos');
                
                if (movimientos.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 p-4">No hay movimientos registrados</p>';
                    return;
                }

                // Ordenar por fecha descendente
                movimientos.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

                const html = `
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Descripci√≥n</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cuenta</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Categor√≠a</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Importe</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${movimientos.map(m => {
                                const cuenta = cuentas.find(c => c.id == m.cuentaId);
                                const categoria = categorias.find(c => c.id == m.categoriaId);
                                const inmueble = inmuebles.find(i => i.id == m.inmuebleId);
                                return `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${new Date(m.fecha).toLocaleDateString()}
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-900">
                                            <div>${m.descripcion}</div>
                                            ${inmueble ? `<div class="text-xs text-blue-600">üìç ${inmueble.codigo}</div>` : ''}
                                            ${m.etiquetas ? `<div class="text-xs text-gray-500">${m.etiquetas}</div>` : ''}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            ${cuenta ? cuenta.nombre : '-'}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            ${categoria ? categoria.nombre : '-'}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-medium ${m.importe >= 0 ? 'text-green-600' : 'text-red-600'}">
                                            ${m.importe >= 0 ? '+' : ''}${m.importe.toFixed(2)} ‚Ç¨
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
                container.innerHTML = html;
            } catch (error) {
                console.error('Error al cargar movimientos:', error);
            }
        }

        async function cargarCuentas() {
            try {
                const cuentas = await obtenerTodos('cuentas');
                const movimientos = await obtenerTodos('movimientos');
                const container = document.getElementById('listaCuentas');
                
                if (cuentas.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay cuentas registradas</p>';
                    return;
                }

                container.innerHTML = cuentas.map(c => {
                    // Calcular saldo actual
                    const movimientosCuenta = movimientos.filter(m => m.cuentaId == c.id);
                    const totalMovimientos = movimientosCuenta.reduce((sum, m) => sum + m.importe, 0);
                    const saldoActual = c.saldoInicial + totalMovimientos;

                    return `
                        <div class="bg-white rounded-lg shadow p-6 relative">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800">${c.nombre}</h3>
                                    <p class="text-sm text-gray-500">${c.tipo}</p>
                                </div>
                                <span class="text-lg font-bold ${saldoActual >= 0 ? 'text-green-600' : 'text-red-600'} whitespace-nowrap">
                                    ${saldoActual.toFixed(2)} ‚Ç¨
                                </span>
                            </div>
                            <div class="text-sm text-gray-500 pb-12">
                                <p>IBAN: ${c.iban || 'N/A'}</p>
                                <p>Entidad: ${c.entidad || 'N/A'}</p>
                                <p class="mt-2">Saldo inicial: ${c.saldoInicial.toFixed(2)} ‚Ç¨</p>
                            </div>
                            <div class="action-buttons-bottom">
                                <button onclick="editarCuenta(${c.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="eliminarCuenta(${c.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar cuentas:', error);
            }
        }

        async function cargarCategorias() {
            try {
                const categorias = await obtenerTodos('categorias');
                const container = document.getElementById('listaCategorias');
                
                if (categorias.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay categor√≠as registradas</p>';
                    return;
                }

                container.innerHTML = categorias.map(c => `
                    <div class="bg-white rounded-lg shadow p-4 relative">
                        <div class="action-buttons">
                            <button onclick="editarCategoria(${c.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="eliminarCategoria(${c.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="w-4 h-4 rounded" style="background-color: ${c.color}"></div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <h3 class="font-bold text-gray-800">${c.nombre}</h3>
                                    <span class="text-xs px-2 py-1 rounded ${c.tipo === 'Ingreso' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${c.tipo}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-500">${c.descripcion || ''}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error al cargar categor√≠as:', error);
            }
        }

        async function cargarComunidades() {
            try {
                const comunidades = await obtenerTodos('comunidades');
                const container = document.getElementById('listaComunidades');
                
                if (comunidades.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay comunidades registradas</p>';
                    return;
                }

                container.innerHTML = comunidades.map(c => `
                    <div class="bg-white rounded-lg shadow p-6 relative">
                        <div class="action-buttons">
                            <button onclick="editarComunidad(${c.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="eliminarComunidad(${c.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2">${c.nombre}</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-500">NIF:</span>
                                <p class="font-medium">${c.nif || 'N/A'}</p>
                            </div>
                            <div>
                                <span class="text-gray-500">Tel√©fono:</span>
                                <p class="font-medium">${c.telefono || 'N/A'}</p>
                            </div>
                            <div class="col-span-2">
                                <span class="text-gray-500">Direcci√≥n:</span>
                                <p class="font-medium">${c.direccion || 'N/A'}</p>
                            </div>
                            <div class="col-span-2">
                                <span class="text-gray-500">Email:</span>
                                <p class="font-medium">${c.email || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error al cargar comunidades:', error);
            }
        }

        async function cargarEventos() {
            try {
                const eventos = await obtenerTodos('eventos');
                const inmuebles = await obtenerTodos('inmuebles');
                const container = document.getElementById('listaEventos');
                
                if (eventos.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No hay eventos registrados</p>';
                    return;
                }

                // Ordenar por fecha
                eventos.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));

                container.innerHTML = eventos.map(e => {
                    const inmueble = inmuebles.find(i => i.id == e.inmuebleId);
                    const fechaEvento = new Date(e.fecha);
                    const hoy = new Date();
                    const esPasado = fechaEvento < hoy;
                    
                    return `
                        <div class="bg-white rounded-lg shadow p-6 relative ${esPasado ? 'opacity-60' : ''}">
                            <div class="action-buttons">
                                <button onclick="editarEvento(${e.id})" class="text-blue-600 hover:text-blue-800 p-1" title="Editar">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="eliminarEvento(${e.id})" class="text-red-600 hover:text-red-800 p-1" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                            <div class="flex items-center gap-2 mb-2">
                                <h3 class="text-lg font-bold text-gray-800">${e.descripcion}</h3>
                                <span class="text-sm px-2 py-1 rounded ${esPasado ? 'bg-gray-200 text-gray-600' : 'bg-blue-100 text-blue-800'}">
                                    ${fechaEvento.toLocaleDateString()}
                                </span>
                            </div>
                            <div class="text-sm text-gray-600">
                                <p>Tipo: ${e.tipo}</p>
                                ${inmueble ? `<p>Inmueble: ${inmueble.codigo}</p>` : ''}
                                ${e.importe > 0 ? `<p class="font-medium text-green-600">Importe: ${e.importe.toFixed(2)} ‚Ç¨</p>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar eventos:', error);
            }
        }

        // ============================================
        // FUNCIONES DE EDICI√ìN Y ELIMINACI√ìN
        // ============================================

        // Funciones de eliminaci√≥n con confirmaci√≥n
        async function eliminarPromocion(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar esta promoci√≥n?')) {
                try {
                    await eliminarRegistro('promociones', id);
                    await cargarPromociones();
                    mostrarNotificacion('Promoci√≥n eliminada correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarInmueble(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar este inmueble?\n\nNOTA: Esto no eliminar√° los registros relacionados (alquileres, seguros, etc.)')) {
                try {
                    await eliminarRegistro('inmuebles', id);
                    await cargarInmuebles();
                    await cargarDashboard();
                    mostrarNotificacion('Inmueble eliminado correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarSeguro(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar este seguro?')) {
                try {
                    await eliminarRegistro('seguros', id);
                    await cargarSeguros();
                    mostrarNotificacion('‚úÖ Seguro eliminado correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarGarantia(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar esta garant√≠a?')) {
                try {
                    await eliminarRegistro('garantias', id);
                    await cargarGarantias();
                    mostrarNotificacion('‚úÖ Garant√≠a eliminada correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarVenta(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar este registro de venta?')) {
                try {
                    await eliminarRegistro('ventas', id);
                    await cargarVentas();
                    mostrarNotificacion('‚úÖ Venta eliminada correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarAlquiler(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar este alquiler?')) {
                try {
                    await eliminarRegistro('alquileres', id);
                    await cargarAlquileres();
                    await cargarDashboard();
                    mostrarNotificacion('‚úÖ Alquiler eliminado correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarCuenta(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar esta cuenta bancaria?\n\nNOTA: Esto no eliminar√° los movimientos asociados.')) {
                try {
                    await eliminarRegistro('cuentas', id);
                    await cargarCuentas();
                    mostrarNotificacion('‚úÖ Cuenta eliminada correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarCategoria(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar esta categor√≠a?')) {
                try {
                    await eliminarRegistro('categorias', id);
                    await cargarCategorias();
                    mostrarNotificacion('‚úÖ Categor√≠a eliminada correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarComunidad(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar esta comunidad?')) {
                try {
                    await eliminarRegistro('comunidades', id);
                    await cargarComunidades();
                    mostrarNotificacion('‚úÖ Comunidad eliminada correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        async function eliminarEvento(id) {
            if (await mostrarConfirmacion('¬øEst√°s seguro de que deseas eliminar este evento?')) {
                try {
                    await eliminarRegistro('eventos', id);
                    await cargarEventos();
                    mostrarNotificacion('‚úÖ Evento eliminado correctamente', 'success');
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al eliminar: ' + error.message, 'error');
                }
            }
        }

        // Funciones de edici√≥n - cargan el formulario con datos existentes
        async function editarPromocion(id) {
            try {
                const promocion = await obtenerPorId('promociones', id);
                
                const contenido = `
                    <form id="formPromocion" class="space-y-4">
                        <input type="hidden" id="promocionId" value="${id}">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nombre de la Promoci√≥n</label>
                            <input type="text" name="nombre" required value="${promocion.nombre || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Direcci√≥n</label>
                            <input type="text" name="direccion" value="${promocion.direccion || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Descripci√≥n</label>
                            <textarea name="descripcion" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">${promocion.descripcion || ''}</textarea>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Promoci√≥n
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Promoci√≥n', contenido);
                document.getElementById('formPromocion').onsubmit = guardarPromocion;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar promoci√≥n: ' + error.message, 'error');
            }
        }

        async function editarInmueble(id) {
            try {
                const inmueble = await obtenerPorId('inmuebles', id);
                const promociones = await obtenerTodos('promociones');
                const opcionesPromociones = promociones.map(p => 
                    `<option value="${p.id}" ${p.id == inmueble.promocionId ? 'selected' : ''}>${p.nombre}</option>`
                ).join('');

                const contenido = `
                    <form id="formInmueble" class="space-y-4">
                        <input type="hidden" id="inmuebleId" value="${id}">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">C√≥digo del Inmueble *</label>
                                <input type="text" name="codigo" required value="${inmueble.codigo || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Promoci√≥n</label>
                                <select name="promocionId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                    <option value="">Sin promoci√≥n</option>
                                    ${opcionesPromociones}
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Direcci√≥n Completa</label>
                            <input type="text" name="direccion" value="${inmueble.direccion || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">M2 Vivienda</label>
                                <input type="number" step="0.01" name="m2Vivienda" value="${inmueble.m2Vivienda || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">M2 Terraza</label>
                                <input type="number" step="0.01" name="m2Terraza" value="${inmueble.m2Terraza || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">N¬∫ Finca</label>
                                <input type="text" name="numFinca" value="${inmueble.numFinca || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Referencia Catastral</label>
                                <input type="text" name="referenciaCatastral" value="${inmueble.referenciaCatastral || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Tipo</label>
                                <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                    <option value="Piso" ${inmueble.tipo === 'Piso' ? 'selected' : ''}>Piso</option>
                                    <option value="Casa" ${inmueble.tipo === 'Casa' ? 'selected' : ''}>Casa</option>
                                    <option value="Local" ${inmueble.tipo === 'Local' ? 'selected' : ''}>Local</option>
                                    <option value="Garaje" ${inmueble.tipo === 'Garaje' ? 'selected' : ''}>Garaje</option>
                                    <option value="Trastero" ${inmueble.tipo === 'Trastero' ? 'selected' : ''}>Trastero</option>
                                    <option value="Terreno" ${inmueble.tipo === 'Terreno' ? 'selected' : ''}>Terreno</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Valor de Adquisici√≥n (‚Ç¨)</label>
                                <input type="number" step="0.01" name="valorAdquisicion" value="${inmueble.valorAdquisicion || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">% Propiedad</label>
                                <input type="number" step="0.01" name="porcentajePropiedad" value="${inmueble.porcentajePropiedad || 100}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Titular</label>
                            <input type="text" name="titular" value="${inmueble.titular || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Inmueble
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Inmueble', contenido);
                document.getElementById('formInmueble').onsubmit = guardarInmueble;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar inmueble: ' + error.message, 'error');
            }
        }

        async function editarSeguro(id) {
            try {
                const seguro = await obtenerPorId('seguros', id);
                const inmuebles = await obtenerTodos('inmuebles');
                const opcionesInmuebles = inmuebles.map(i => 
                    `<option value="${i.id}" ${i.id == seguro.inmuebleId ? 'selected' : ''}>${i.codigo} - ${i.direccion || ''}</option>`
                ).join('');

                const contenido = `
                    <form id="formSeguro" class="space-y-4">
                        <input type="hidden" id="seguroId" value="${id}">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">N√∫mero de P√≥liza *</label>
                                <input type="text" name="numeroPoliza" required value="${seguro.numeroPoliza || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Estado</label>
                                <select name="estado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                    <option value="Activo" ${seguro.estado === 'Activo' ? 'selected' : ''}>Activo</option>
                                    <option value="Cerrado" ${seguro.estado === 'Cerrado' ? 'selected' : ''}>Cerrado</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Aseguradora</label>
                                <input type="text" name="aseguradora" value="${seguro.aseguradora || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Corredur√≠a</label>
                                <input type="text" name="correduria" value="${seguro.correduria || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Fecha Contrataci√≥n</label>
                                <input type="date" name="fechaContratacion" value="${seguro.fechaContratacion || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Precio (‚Ç¨)</label>
                                <input type="number" step="0.01" name="precio" value="${seguro.precio || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Inmueble</label>
                            <select name="inmuebleId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">No vinculado</option>
                                ${opcionesInmuebles}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tomador</label>
                            <input type="text" name="tomador" value="${seguro.tomador || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Seguro
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Seguro', contenido);
                document.getElementById('formSeguro').onsubmit = guardarSeguro;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar seguro: ' + error.message, 'error');
            }
        }

        async function editarGarantia(id) {
            try {
                const garantia = await obtenerPorId('garantias', id);
                const inmuebles = await obtenerTodos('inmuebles');
                const opcionesInmuebles = inmuebles.map(i => 
                    `<option value="${i.id}" ${i.id == garantia.inmuebleId ? 'selected' : ''}>${i.codigo} - ${i.direccion || ''}</option>`
                ).join('');

                const contenido = `
                    <form id="formGarantia" class="space-y-4">
                        <input type="hidden" id="garantiaId" value="${id}">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Electrodom√©stico/Modelo *</label>
                                <input type="text" name="electrodomestico" required value="${garantia.electrodomestico || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Proveedor</label>
                                <input type="text" name="proveedor" value="${garantia.proveedor || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Fecha de Compra</label>
                                <input type="date" name="fechaCompra" value="${garantia.fechaCompra || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Precio (‚Ç¨)</label>
                                <input type="number" step="0.01" name="precio" value="${garantia.precio || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Inmueble</label>
                            <select name="inmuebleId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">No vinculado</option>
                                ${opcionesInmuebles}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Inquilinos</label>
                            <input type="text" name="inquilinos" value="${garantia.inquilinos || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Garant√≠a
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Garant√≠a', contenido);
                document.getElementById('formGarantia').onsubmit = guardarGarantia;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar garant√≠a: ' + error.message, 'error');
            }
        }

        async function editarVenta(id) {
            try {
                const venta = await obtenerPorId('ventas', id);
                const inmuebles = await obtenerTodos('inmuebles');
                const opcionesInmuebles = inmuebles.map(i => 
                    `<option value="${i.id}" ${i.id == venta.inmuebleId ? 'selected' : ''}>${i.codigo} - ${i.direccion || ''}</option>`
                ).join('');

                const contenido = `
                    <form id="formVenta" class="space-y-4">
                        <input type="hidden" id="ventaId" value="${id}">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Inmueble *</label>
                            <select name="inmuebleId" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">Seleccionar inmueble</option>
                                ${opcionesInmuebles}
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Comprador</label>
                                <input type="text" name="comprador" value="${venta.comprador || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">DNI Comprador</label>
                                <input type="text" name="dniComprador" value="${venta.dniComprador || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Precio de Venta (‚Ç¨) *</label>
                                <input type="number" step="0.01" name="precioVenta" required value="${venta.precioVenta || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Fecha de Venta</label>
                                <input type="date" name="fechaVenta" value="${venta.fechaVenta || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Notar√≠a / N√∫m. Escritura</label>
                            <input type="text" name="notaria" value="${venta.notaria || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Venta
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Venta', contenido);
                document.getElementById('formVenta').onsubmit = guardarVenta;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar venta: ' + error.message, 'error');
            }
        }

        async function editarAlquiler(id) {
            try {
                const alquiler = await obtenerPorId('alquileres', id);
                const inmuebles = await obtenerTodos('inmuebles');
                const opcionesInmuebles = inmuebles.map(i => 
                    `<option value="${i.id}" ${i.id == alquiler.inmuebleId ? 'selected' : ''}>${i.codigo} - ${i.direccion || ''}</option>`
                ).join('');

                const contenido = `
                    <form id="formAlquiler" class="space-y-4">
                        <input type="hidden" id="alquilerId" value="${id}">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Nombre del Inquilino *</label>
                                <input type="text" name="nombreInquilino" required value="${alquiler.nombreInquilino || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">DNI</label>
                                <input type="text" name="dniInquilino" value="${alquiler.dniInquilino || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Inmueble *</label>
                            <select name="inmuebleId" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">Seleccionar inmueble</option>
                                ${opcionesInmuebles}
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Precio Inicial (‚Ç¨) *</label>
                                <input type="number" step="0.01" name="precioInicial" required value="${alquiler.precioInicial || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Precio Actual (‚Ç¨)</label>
                                <input type="number" step="0.01" name="precioActual" value="${alquiler.precioActual || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Fecha Inicio</label>
                                <input type="date" name="fechaInicio" value="${alquiler.fechaInicio || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Pr√≥xima Renovaci√≥n</label>
                                <input type="date" name="proximaRenovacion" value="${alquiler.proximaRenovacion || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Fecha Fin</label>
                                <input type="date" name="fechaFin" value="${alquiler.fechaFin || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Estado</label>
                            <select name="estado" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="activo" ${alquiler.estado === 'activo' ? 'selected' : ''}>Activo</option>
                                <option value="finalizado" ${alquiler.estado === 'finalizado' ? 'selected' : ''}>Finalizado</option>
                                <option value="pendiente" ${alquiler.estado === 'pendiente' ? 'selected' : ''}>Pendiente</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Documento</label>
                            <input type="text" name="documento" placeholder="URL o referencia al documento" value="${alquiler.documento || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Alquiler
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Alquiler', contenido);
                document.getElementById('formAlquiler').onsubmit = guardarAlquiler;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar alquiler: ' + error.message, 'error');
            }
        }

        async function editarCuenta(id) {
            try {
                const cuenta = await obtenerPorId('cuentas', id);
                
                const contenido = `
                    <form id="formCuenta" class="space-y-4">
                        <input type="hidden" id="cuentaId" value="${id}">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nombre de la Cuenta *</label>
                            <input type="text" name="nombre" required placeholder="Ej: Banca March - Personal" value="${cuenta.nombre || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tipo de Cuenta</label>
                            <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="Corriente" ${cuenta.tipo === 'Corriente' ? 'selected' : ''}>Corriente</option>
                                <option value="Ahorro" ${cuenta.tipo === 'Ahorro' ? 'selected' : ''}>Ahorro</option>
                                <option value="Efectivo" ${cuenta.tipo === 'Efectivo' ? 'selected' : ''}>Efectivo</option>
                                <option value="Inversi√≥n" ${cuenta.tipo === 'Inversi√≥n' ? 'selected' : ''}>Inversi√≥n</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Saldo Inicial (‚Ç¨)</label>
                            <input type="number" step="0.01" name="saldoInicial" value="${cuenta.saldoInicial || 0}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">IBAN</label>
                            <input type="text" name="iban" placeholder="ES00 0000 0000 00 0000000000" value="${cuenta.iban || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Entidad Bancaria</label>
                            <input type="text" name="entidad" value="${cuenta.entidad || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Cuenta
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Cuenta Bancaria', contenido);
                document.getElementById('formCuenta').onsubmit = guardarCuenta;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar cuenta: ' + error.message, 'error');
            }
        }

        async function editarCategoria(id) {
            try {
                const categoria = await obtenerPorId('categorias', id);
                
                const contenido = `
                    <form id="formCategoria" class="space-y-4">
                        <input type="hidden" id="categoriaId" value="${id}">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nombre de la Categor√≠a *</label>
                            <input type="text" name="nombre" required placeholder="Ej: Impuestos, Cobros, Gastos" value="${categoria.nombre || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tipo</label>
                            <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="Ingreso" ${categoria.tipo === 'Ingreso' ? 'selected' : ''}>Ingreso</option>
                                <option value="Gasto" ${categoria.tipo === 'Gasto' ? 'selected' : ''}>Gasto</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Color (opcional)</label>
                            <input type="color" name="color" value="${categoria.color || '#3b82f6'}" class="mt-1 block w-full h-10 rounded-md border-gray-300 shadow-sm p-1 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Descripci√≥n</label>
                            <textarea name="descripcion" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">${categoria.descripcion || ''}</textarea>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Categor√≠a
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Categor√≠a', contenido);
                document.getElementById('formCategoria').onsubmit = guardarCategoria;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar categor√≠a: ' + error.message, 'error');
            }
        }

        async function editarComunidad(id) {
            try {
                const comunidad = await obtenerPorId('comunidades', id);
                
                const contenido = `
                    <form id="formComunidad" class="space-y-4">
                        <input type="hidden" id="comunidadId" value="${id}">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nombre de la Comunidad *</label>
                            <input type="text" name="nombre" required value="${comunidad.nombre || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">NIF</label>
                            <input type="text" name="nif" value="${comunidad.nif || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Direcci√≥n</label>
                            <input type="text" name="direccion" value="${comunidad.direccion || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                            <input type="tel" name="telefono" value="${comunidad.telefono || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" name="email" value="${comunidad.email || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Comunidad
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Comunidad', contenido);
                document.getElementById('formComunidad').onsubmit = guardarComunidad;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar comunidad: ' + error.message, 'error');
            }
        }

        async function editarEvento(id) {
            try {
                const evento = await obtenerPorId('eventos', id);
                const inmuebles = await obtenerTodos('inmuebles');
                const opcionesInmuebles = inmuebles.map(i => 
                    `<option value="${i.id}" ${i.id == evento.inmuebleId ? 'selected' : ''}>${i.codigo}</option>`
                ).join('');

                const contenido = `
                    <form id="formEvento" class="space-y-4">
                        <input type="hidden" id="eventoId" value="${id}">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Fecha del Evento *</label>
                                <input type="date" name="fecha" required value="${evento.fecha || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Tipo de Evento</label>
                                <select name="tipo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                    <option value="Vencimiento" ${evento.tipo === 'Vencimiento' ? 'selected' : ''}>Vencimiento</option>
                                    <option value="Renovaci√≥n" ${evento.tipo === 'Renovaci√≥n' ? 'selected' : ''}>Renovaci√≥n</option>
                                    <option value="Pago" ${evento.tipo === 'Pago' ? 'selected' : ''}>Pago</option>
                                    <option value="Reuni√≥n" ${evento.tipo === 'Reuni√≥n' ? 'selected' : ''}>Reuni√≥n</option>
                                    <option value="Mantenimiento" ${evento.tipo === 'Mantenimiento' ? 'selected' : ''}>Mantenimiento</option>
                                    <option value="Otro" ${evento.tipo === 'Otro' ? 'selected' : ''}>Otro</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Descripci√≥n *</label>
                            <input type="text" name="descripcion" required value="${evento.descripcion || ''}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Inmueble Vinculado</label>
                            <select name="inmuebleId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="">No vinculado</option>
                                ${opcionesInmuebles}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Importe Asociado (‚Ç¨)</label>
                            <input type="number" step="0.01" name="importe" value="${evento.importe || 0}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                Cancelar
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Actualizar Evento
                            </button>
                        </div>
                    </form>
                `;
                abrirModal('Editar Evento', contenido);
                document.getElementById('formEvento').onsubmit = guardarEvento;
            } catch (error) {
                mostrarNotificacion('‚ùå Error al cargar evento: ' + error.message, 'error');
            }
        }

        // ============================================
        // FUNCIONES DE EXPORTAR/IMPORTAR DATOS
        // ============================================

        /**
         * Exporta todos los datos de IndexedDB a un archivo JSON descargable
         */
        async function exportarBaseDatos() {
            try {
                // Obtener todas las tablas definidas en la base de datos
                const tablas = ['promociones', 'inmuebles', 'seguros', 'garantias', 'ventas', 
                               'alquileres', 'movimientos', 'cuentas', 'categorias', 'comunidades', 'eventos'];
                
                const datosExportacion = {
                    version: '1.0',
                    aplicacion: 'Gesti√≥n Patrimonial',
                    fechaExportacion: new Date().toISOString(),
                    totalRegistros: 0,
                    datos: {}
                };

                // Obtener datos de cada tabla y contar registros
                let totalRegistros = 0;
                for (const tabla of tablas) {
                    const registros = await obtenerTodos(tabla);
                    datosExportacion.datos[tabla] = registros;
                    totalRegistros += registros.length;
                }
                
                datosExportacion.totalRegistros = totalRegistros;

                // Validar que hay datos para exportar
                if (totalRegistros === 0) {
                    mostrarNotificacion('‚ö†Ô∏è No hay datos para exportar. La base de datos est√° vac√≠a.', 'info');
                    return;
                }

                // Crear el archivo JSON
                const jsonString = JSON.stringify(datosExportacion, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                // Crear enlace de descarga
                const a = document.createElement('a');
                a.href = url;
                a.download = `gestion-patrimonial-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                mostrarNotificacion(`‚úÖ Datos exportados correctamente\n\n${totalRegistros} registros exportados en ${tablas.length} tablas`, 'success');
            } catch (error) {
                console.error('Error al exportar datos:', error);
                mostrarNotificacion('‚ùå Error al exportar los datos:\n' + error.message, 'error');
            }
        }

        /**
         * Importa datos desde un archivo JSON al IndexedDB
         */
        async function importarBaseDatos() {
            try {
                const input = document.getElementById('archivoImportar');
                const archivo = input.files[0];

                if (!archivo) {
                    mostrarNotificacion('‚ö†Ô∏è Por favor selecciona un archivo JSON para importar', 'info');
                    return;
                }

                // Validar tipo de archivo
                if (!archivo.name.endsWith('.json')) {
                    mostrarNotificacion('‚ùå El archivo debe ser de tipo JSON (.json)', 'error');
                    return;
                }

                // Leer el archivo
                const texto = await archivo.text();
                let datosImportados;
                
                try {
                    datosImportados = JSON.parse(texto);
                } catch (parseError) {
                    throw new Error('El archivo no es un JSON v√°lido');
                }

                // Validar estructura del archivo
                if (!datosImportados.datos || typeof datosImportados.datos !== 'object') {
                    throw new Error('Formato de archivo inv√°lido: falta la propiedad "datos"');
                }

                if (!datosImportados.aplicacion || datosImportados.aplicacion !== 'Gesti√≥n Patrimonial') {
                    const continuar = await mostrarConfirmacion(
                        '‚ö†Ô∏è Este archivo no parece ser de Gesti√≥n Patrimonial.\n\n¬øDeseas continuar de todos modos?'
                    );
                    if (!continuar) return;
                }

                // Mostrar informaci√≥n del archivo
                const totalRegistrosArchivo = datosImportados.totalRegistros || 
                    Object.values(datosImportados.datos).reduce((sum, arr) => sum + (Array.isArray(arr) ? arr.length : 0), 0);

                // Confirmar importaci√≥n
                const confirmar = await mostrarConfirmacion(
                    `¬øDeseas importar los datos del archivo?\n\n` +
                    `üìÅ Archivo: ${archivo.name}\n` +
                    `üìÖ Fecha de exportaci√≥n: ${new Date(datosImportados.fechaExportacion).toLocaleString()}\n` +
                    `üìä Registros a importar: ${totalRegistrosArchivo}\n\n` +
                    `‚ö†Ô∏è Los datos se a√±adir√°n a los existentes (no se borrar√°n los datos actuales)`
                );

                if (!confirmar) {
                    return;
                }

                let totalImportados = 0;
                let erroresImportacion = 0;

                // Importar datos de cada tabla
                for (const [tabla, registros] of Object.entries(datosImportados.datos)) {
                    if (Array.isArray(registros)) {
                        for (const registro of registros) {
                            try {
                                // Eliminar el ID para que se genere uno nuevo y evitar conflictos
                                const registroSinId = { ...registro };
                                delete registroSinId.id;
                                
                                await agregarRegistro(tabla, registroSinId);
                                totalImportados++;
                            } catch (errorRegistro) {
                                console.error(`Error al importar registro en tabla ${tabla}:`, errorRegistro);
                                erroresImportacion++;
                            }
                        }
                    }
                }

                // Mensaje de resultado
                let mensaje = `‚úÖ Importaci√≥n completada\n\n` +
                             `üì• ${totalImportados} registros importados correctamente`;
                
                if (erroresImportacion > 0) {
                    mensaje += `\n‚ö†Ô∏è ${erroresImportacion} registros con errores (ver consola)`;
                }

                mostrarNotificacion(mensaje, 'success');
                
                // Limpiar el input de archivo
                input.value = '';
                
                // Recargar la secci√≥n actual
                const seccionActual = document.querySelector('.section.active');
                if (seccionActual) {
                    await cargarDatosSeccion(seccionActual.id);
                }
                
                // Actualizar el dashboard tambi√©n
                await cargarDashboard();
                
            } catch (error) {
                console.error('Error al importar datos:', error);
                mostrarNotificacion('‚ùå Error al importar los datos:\n\n' + error.message, 'error');
            }
        }

        // ============================================
        // FUNCI√ìN DE PRUEBA (SOLO PARA DESARROLLO)
        // ============================================
        
        /**
         * Crea 12 datos de ejemplo para cada m√≥dulo (solo llamar manualmente desde consola)
         */
        async function crearDatosDePrueba() {
            try {
                console.log('Iniciando creaci√≥n de datos de prueba...');
                
                // 1. PROMOCIONES (12 ejemplos)
                const promociones = [
                    { nombre: 'Residencial Vista Mar', ubicacion: 'M√°laga', descripcion: 'Viviendas en primera l√≠nea de playa', fechaInicio: '2023-01-15' },
                    { nombre: 'Torre del Parque', ubicacion: 'Madrid', descripcion: 'Pisos de lujo junto al Retiro', fechaInicio: '2023-03-20' },
                    { nombre: 'Jardines de Valencia', ubicacion: 'Valencia', descripcion: 'Chalets adosados con jard√≠n', fechaInicio: '2023-05-10' },
                    { nombre: 'Marina Barcelona', ubicacion: 'Barcelona', descripcion: '√Åticos con vistas al mar', fechaInicio: '2023-07-01' },
                    { nombre: 'Plaza Mayor Centro', ubicacion: 'Sevilla', descripcion: 'Apartamentos en el centro hist√≥rico', fechaInicio: '2023-09-12' },
                    { nombre: 'Golf Marbella', ubicacion: 'Marbella', descripcion: 'Villas en campo de golf', fechaInicio: '2024-01-05' },
                    { nombre: 'Sierra de Bilbao', ubicacion: 'Bilbao', descripcion: 'Casas rurales con vistas', fechaInicio: '2024-02-14' },
                    { nombre: 'Costa Blanca Sol', ubicacion: 'Alicante', descripcion: 'Bungalows cerca de la playa', fechaInicio: '2024-03-22' },
                    { nombre: 'Urbano Zaragoza', ubicacion: 'Zaragoza', descripcion: 'Pisos modernos en zona comercial', fechaInicio: '2024-04-18' },
                    { nombre: 'Las Palmas Resort', ubicacion: 'Gran Canaria', descripcion: 'Complejo vacacional', fechaInicio: '2024-05-30' },
                    { nombre: 'Camino de Santiago', ubicacion: 'A Coru√±a', descripcion: 'Estudios para peregrinos', fechaInicio: '2024-06-15' },
                    { nombre: 'Turia Gardens', ubicacion: 'Valencia', descripcion: 'Lofts modernos', fechaInicio: '2024-07-08' }
                ];
                for (const p of promociones) await agregarRegistro('promociones', p);

                // 2. COMUNIDADES (12 ejemplos)
                const comunidades = [
                    { nombre: 'Comunidad Vista Mar', nif: 'H12345001', direccion: 'Av. del Mar 1, M√°laga', telefono: '952111001', email: 'vistamar@email.com' },
                    { nombre: 'Comunidad Torre Parque', nif: 'H12345002', direccion: 'C/ Retiro 23, Madrid', telefono: '911222002', email: 'torreparque@email.com' },
                    { nombre: 'Comunidad Jardines Valencia', nif: 'H12345003', direccion: 'Av. Blasco 45, Valencia', telefono: '963333003', email: 'jardines@email.com' },
                    { nombre: 'Comunidad Marina BCN', nif: 'H12345004', direccion: 'Paseo Mar√≠timo 67, Barcelona', telefono: '934444004', email: 'marina@email.com' },
                    { nombre: 'Comunidad Plaza Mayor', nif: 'H12345005', direccion: 'Plaza Mayor 8, Sevilla', telefono: '954555005', email: 'plaza@email.com' },
                    { nombre: 'Comunidad Golf Marbella', nif: 'H12345006', direccion: 'Urb. Golf 12, Marbella', telefono: '952666006', email: 'golf@email.com' },
                    { nombre: 'Comunidad Sierra Bilbao', nif: 'H12345007', direccion: 'C/ Monte 34, Bilbao', telefono: '944777007', email: 'sierra@email.com' },
                    { nombre: 'Comunidad Costa Blanca', nif: 'H12345008', direccion: 'Playa San Juan 56, Alicante', telefono: '965888008', email: 'costablanca@email.com' },
                    { nombre: 'Comunidad Urbano Zaragoza', nif: 'H12345009', direccion: 'C/ Comercio 78, Zaragoza', telefono: '976999009', email: 'urbano@email.com' },
                    { nombre: 'Comunidad Las Palmas', nif: 'H12345010', direccion: 'Av. Canarias 90, Gran Canaria', telefono: '928100010', email: 'laspalmas@email.com' },
                    { nombre: 'Comunidad Camino Santiago', nif: 'H12345011', direccion: 'R√∫a Peregrino 12, A Coru√±a', telefono: '981110011', email: 'camino@email.com' },
                    { nombre: 'Comunidad Turia Gardens', nif: 'H12345012', direccion: 'Jardines del Turia 34, Valencia', telefono: '963120012', email: 'turia@email.com' }
                ];
                for (const c of comunidades) await agregarRegistro('comunidades', c);

                // 3. INMUEBLES (12 ejemplos)
                const inmuebles = [
                    { codigo: 'VIS-A101', tipo: 'Piso', direccion: 'Av. del Mar 1-1A, M√°laga', metrosCuadrados: 85, valoracion: 285000, porcentajePropiedad: 100, promocionId: 1, comunidadId: 1, refCatastral: '1234567VR0012A' },
                    { codigo: 'TOR-B205', tipo: '√Åtico', direccion: 'C/ Retiro 23-2B, Madrid', metrosCuadrados: 120, valoracion: 450000, porcentajePropiedad: 100, promocionId: 2, comunidadId: 2, refCatastral: '2345678VR0023B' },
                    { codigo: 'JAR-C303', tipo: 'Chalet', direccion: 'Av. Blasco 45-3C, Valencia', metrosCuadrados: 180, valoracion: 380000, porcentajePropiedad: 100, promocionId: 3, comunidadId: 3, refCatastral: '3456789VR0034C' },
                    { codigo: 'MAR-D104', tipo: '√Åtico', direccion: 'Paseo Mar√≠timo 67-1D, Barcelona', metrosCuadrados: 95, valoracion: 520000, porcentajePropiedad: 100, promocionId: 4, comunidadId: 4, refCatastral: '4567890VR0045D' },
                    { codigo: 'PLZ-E201', tipo: 'Apartamento', direccion: 'Plaza Mayor 8-2E, Sevilla', metrosCuadrados: 65, valoracion: 195000, porcentajePropiedad: 100, promocionId: 5, comunidadId: 5, refCatastral: '5678901VR0056E' },
                    { codigo: 'GOL-F102', tipo: 'Villa', direccion: 'Urb. Golf 12-1F, Marbella', metrosCuadrados: 250, valoracion: 890000, porcentajePropiedad: 100, promocionId: 6, comunidadId: 6, refCatastral: '6789012VR0067F' },
                    { codigo: 'SIE-G203', tipo: 'Casa', direccion: 'C/ Monte 34-2G, Bilbao', metrosCuadrados: 145, valoracion: 320000, porcentajePropiedad: 100, promocionId: 7, comunidadId: 7, refCatastral: '7890123VR0078G' },
                    { codigo: 'COS-H105', tipo: 'Bungalow', direccion: 'Playa San Juan 56-1H, Alicante', metrosCuadrados: 78, valoracion: 235000, porcentajePropiedad: 100, promocionId: 8, comunidadId: 8, refCatastral: '8901234VR0089H' },
                    { codigo: 'URB-I301', tipo: 'Piso', direccion: 'C/ Comercio 78-3I, Zaragoza', metrosCuadrados: 92, valoracion: 185000, porcentajePropiedad: 100, promocionId: 9, comunidadId: 9, refCatastral: '9012345VR0090I' },
                    { codigo: 'PAL-J202', tipo: 'Apartamento', direccion: 'Av. Canarias 90-2J, Gran Canaria', metrosCuadrados: 70, valoracion: 210000, porcentajePropiedad: 100, promocionId: 10, comunidadId: 10, refCatastral: '0123456VR0101J' },
                    { codigo: 'CAM-K104', tipo: 'Estudio', direccion: 'R√∫a Peregrino 12-1K, A Coru√±a', metrosCuadrados: 45, valoracion: 125000, porcentajePropiedad: 100, promocionId: 11, comunidadId: 11, refCatastral: '1234567VR0112K' },
                    { codigo: 'TUR-L203', tipo: 'Loft', direccion: 'Jardines del Turia 34-2L, Valencia', metrosCuadrados: 110, valoracion: 295000, porcentajePropiedad: 100, promocionId: 12, comunidadId: 12, refCatastral: '2345678VR0123L' }
                ];
                for (const i of inmuebles) await agregarRegistro('inmuebles', i);

                // 4. CUENTAS BANCARIAS (12 ejemplos)
                const cuentas = [
                    { nombre: 'Cuenta Santander Principal', tipo: 'Cuenta Corriente', iban: 'ES1200491500012345678901', entidad: 'Banco Santander', saldoInicial: 50000 },
                    { nombre: 'Cuenta BBVA Negocios', tipo: 'Cuenta Corriente', iban: 'ES2301822150012345678902', entidad: 'BBVA', saldoInicial: 35000 },
                    { nombre: 'Cuenta CaixaBank Ahorro', tipo: 'Cuenta de Ahorro', iban: 'ES3421000418450012345678', entidad: 'CaixaBank', saldoInicial: 80000 },
                    { nombre: 'Cuenta Bankinter Inversi√≥n', tipo: 'Cuenta de Inversi√≥n', iban: 'ES4501280015230012345679', entidad: 'Bankinter', saldoInicial: 120000 },
                    { nombre: 'Cuenta Sabadell Empresa', tipo: 'Cuenta Corriente', iban: 'ES5600811234560012345680', entidad: 'Banco Sabadell', saldoInicial: 45000 },
                    { nombre: 'Cuenta ING Naranja', tipo: 'Cuenta de Ahorro', iban: 'ES6716550001230012345681', entidad: 'ING Direct', saldoInicial: 25000 },
                    { nombre: 'Cuenta Kutxabank Operativa', tipo: 'Cuenta Corriente', iban: 'ES7820950066320012345682', entidad: 'Kutxabank', saldoInicial: 38000 },
                    { nombre: 'Cuenta Unicaja Dep√≥sitos', tipo: 'Cuenta de Ahorro', iban: 'ES8921030032450012345683', entidad: 'Unicaja', saldoInicial: 95000 },
                    { nombre: 'Cuenta Cajamar Alquileres', tipo: 'Cuenta Corriente', iban: 'ES9030581234560012345684', entidad: 'Cajamar', saldoInicial: 28000 },
                    { nombre: 'Cuenta Abanca Patrimonio', tipo: 'Cuenta de Inversi√≥n', iban: 'ES0120380059870012345685', entidad: 'Abanca', saldoInicial: 150000 },
                    { nombre: 'Cuenta Ibercaja Rentas', tipo: 'Cuenta Corriente', iban: 'ES1220850071230012345686', entidad: 'Ibercaja', saldoInicial: 42000 },
                    { nombre: 'Cuenta Openbank Digital', tipo: 'Cuenta de Ahorro', iban: 'ES2300491876540012345687', entidad: 'Openbank', saldoInicial: 62000 }
                ];
                for (const c of cuentas) await agregarRegistro('cuentas', c);

                // 5. CATEGOR√çAS (12 ejemplos)
                const categorias = [
                    { nombre: 'Alquiler Recibido', tipo: 'Ingreso', color: '#10b981', descripcion: 'Ingresos por alquileres' },
                    { nombre: 'Venta de Inmueble', tipo: 'Ingreso', color: '#059669', descripcion: 'Ingresos por ventas' },
                    { nombre: 'IBI', tipo: 'Gasto', color: '#ef4444', descripcion: 'Impuesto sobre Bienes Inmuebles' },
                    { nombre: 'Comunidad', tipo: 'Gasto', color: '#dc2626', descripcion: 'Gastos de comunidad' },
                    { nombre: 'Seguro', tipo: 'Gasto', color: '#f97316', descripcion: 'Primas de seguros' },
                    { nombre: 'Reparaciones', tipo: 'Gasto', color: '#ea580c', descripcion: 'Mantenimiento y reparaciones' },
                    { nombre: 'Suministros', tipo: 'Gasto', color: '#f59e0b', descripcion: 'Agua, luz, gas' },
                    { nombre: 'Hipoteca', tipo: 'Gasto', color: '#d97706', descripcion: 'Cuotas hipotecarias' },
                    { nombre: 'Administraci√≥n', tipo: 'Gasto', color: '#84cc16', descripcion: 'Gastos administrativos' },
                    { nombre: 'Plusval√≠a', tipo: 'Gasto', color: '#65a30d', descripcion: 'Impuesto plusval√≠a municipal' },
                    { nombre: 'Comisiones', tipo: 'Gasto', color: '#6366f1', descripcion: 'Comisiones inmobiliarias' },
                    { nombre: 'Otros Ingresos', tipo: 'Ingreso', color: '#14b8a6', descripcion: 'Otros ingresos varios' }
                ];
                for (const c of categorias) await agregarRegistro('categorias', c);

                // 6. SEGUROS (12 ejemplos)
                const seguros = [
                    { numeroPoliza: 'SEG-2024-001', compania: 'Mapfre', tipoSeguro: 'Hogar', fechaInicio: '2024-01-15', fechaVencimiento: '2025-01-15', importePrima: 380, inmuebleId: 1 },
                    { numeroPoliza: 'SEG-2024-002', compania: 'Allianz', tipoSeguro: 'Hogar', fechaInicio: '2024-02-01', fechaVencimiento: '2025-02-01', importePrima: 520, inmuebleId: 2 },
                    { numeroPoliza: 'SEG-2024-003', compania: 'Axa', tipoSeguro: 'Multirriesgo', fechaInicio: '2024-03-10', fechaVencimiento: '2025-03-10', importePrima: 680, inmuebleId: 3 },
                    { numeroPoliza: 'SEG-2024-004', compania: 'Zurich', tipoSeguro: 'Hogar Premium', fechaInicio: '2024-04-05', fechaVencimiento: '2025-04-05', importePrima: 890, inmuebleId: 4 },
                    { numeroPoliza: 'SEG-2024-005', compania: 'Generali', tipoSeguro: 'Hogar', fechaInicio: '2024-05-12', fechaVencimiento: '2025-05-12', importePrima: 320, inmuebleId: 5 },
                    { numeroPoliza: 'SEG-2024-006', compania: 'Mapfre', tipoSeguro: 'Hogar Lujo', fechaInicio: '2024-06-20', fechaVencimiento: '2025-06-20', importePrima: 1250, inmuebleId: 6 },
                    { numeroPoliza: 'SEG-2024-007', compania: 'Liberty', tipoSeguro: 'Hogar', fechaInicio: '2024-07-08', fechaVencimiento: '2025-07-08', importePrima: 450, inmuebleId: 7 },
                    { numeroPoliza: 'SEG-2024-008', compania: 'Santaluc√≠a', tipoSeguro: 'Hogar', fechaInicio: '2024-08-15', fechaVencimiento: '2025-08-15', importePrima: 395, inmuebleId: 8 },
                    { numeroPoliza: 'SEG-2024-009', compania: 'Plus Ultra', tipoSeguro: 'Multirriesgo', fechaInicio: '2024-09-01', fechaVencimiento: '2025-09-01', importePrima: 425, inmuebleId: 9 },
                    { numeroPoliza: 'SEG-2024-010', compania: 'Catalana Occidente', tipoSeguro: 'Hogar', fechaInicio: '2024-10-10', fechaVencimiento: '2025-10-10', importePrima: 365, inmuebleId: 10 },
                    { numeroPoliza: 'SEG-2024-011', compania: 'Reale', tipoSeguro: 'Hogar', fechaInicio: '2024-11-05', fechaVencimiento: '2025-11-05', importePrima: 280, inmuebleId: 11 },
                    { numeroPoliza: 'SEG-2024-012', compania: 'Axa', tipoSeguro: 'Hogar Premium', fechaInicio: '2024-12-01', fechaVencimiento: '2025-12-01', importePrima: 525, inmuebleId: 12 }
                ];
                for (const s of seguros) await agregarRegistro('seguros', s);

                // 7. GARANT√çAS (12 ejemplos)
                const garantias = [
                    { descripcion: 'Caldera Junkers', fabricante: 'Junkers', modelo: 'Cerapur', fechaCompra: '2023-05-15', fechaVencimiento: '2025-05-15', inmuebleId: 1 },
                    { descripcion: 'Aire Acondicionado Daikin', fabricante: 'Daikin', modelo: 'FTXM35N', fechaCompra: '2023-06-20', fechaVencimiento: '2025-06-20', inmuebleId: 2 },
                    { descripcion: 'Lavavajillas Bosch', fabricante: 'Bosch', modelo: 'SMV46KX', fechaCompra: '2023-07-10', fechaVencimiento: '2025-07-10', inmuebleId: 3 },
                    { descripcion: 'Horno Teka', fabricante: 'Teka', modelo: 'HBB735', fechaCompra: '2023-08-05', fechaVencimiento: '2025-08-05', inmuebleId: 4 },
                    { descripcion: 'Frigor√≠fico Samsung', fabricante: 'Samsung', modelo: 'RB38T', fechaCompra: '2023-09-12', fechaVencimiento: '2025-09-12', inmuebleId: 5 },
                    { descripcion: 'Sistema Dom√≥tica', fabricante: 'Somfy', modelo: 'TaHoma', fechaCompra: '2023-10-18', fechaVencimiento: '2025-10-18', inmuebleId: 6 },
                    { descripcion: 'Caldera Vaillant', fabricante: 'Vaillant', modelo: 'ecoTEC', fechaCompra: '2023-11-22', fechaVencimiento: '2025-11-22', inmuebleId: 7 },
                    { descripcion: 'Aire Split Mitsubishi', fabricante: 'Mitsubishi', modelo: 'MSZ-EF', fechaCompra: '2023-12-08', fechaVencimiento: '2025-12-08', inmuebleId: 8 },
                    { descripcion: 'Lavadora LG', fabricante: 'LG', modelo: 'F4WV', fechaCompra: '2024-01-15', fechaVencimiento: '2026-01-15', inmuebleId: 9 },
                    { descripcion: 'Placa Inducci√≥n Siemens', fabricante: 'Siemens', modelo: 'EH645', fechaCompra: '2024-02-20', fechaVencimiento: '2026-02-20', inmuebleId: 10 },
                    { descripcion: 'Termo El√©ctrico Ariston', fabricante: 'Ariston', modelo: 'PRO1', fechaCompra: '2024-03-10', fechaVencimiento: '2026-03-10', inmuebleId: 11 },
                    { descripcion: 'Campana Extractora Balay', fabricante: 'Balay', modelo: '3BC997', fechaCompra: '2024-04-05', fechaVencimiento: '2026-04-05', inmuebleId: 12 }
                ];
                for (const g of garantias) await agregarRegistro('garantias', g);

                // 8. ALQUILERES (12 ejemplos)
                const alquileres = [
                    { inmuebleId: 1, nombreInquilino: 'Juan Garc√≠a L√≥pez', dniInquilino: '12345678A', telefonoInquilino: '600111001', emailInquilino: 'juan.garcia@email.com', importeMensual: 950, fechaInicio: '2024-01-01', fechaFin: '2025-01-01', estado: 'Activo' },
                    { inmuebleId: 2, nombreInquilino: 'Mar√≠a Rodr√≠guez P√©rez', dniInquilino: '23456789B', telefonoInquilino: '600222002', emailInquilino: 'maria.rodriguez@email.com', importeMensual: 1450, fechaInicio: '2024-02-01', fechaFin: '2025-02-01', estado: 'Activo' },
                    { inmuebleId: 3, nombreInquilino: 'Carlos Mart√≠nez Sanz', dniInquilino: '34567890C', telefonoInquilino: '600333003', emailInquilino: 'carlos.martinez@email.com', importeMensual: 1250, fechaInicio: '2024-03-01', fechaFin: '2025-03-01', estado: 'Activo' },
                    { inmuebleId: 4, nombreInquilino: 'Ana L√≥pez Fern√°ndez', dniInquilino: '45678901D', telefonoInquilino: '600444004', emailInquilino: 'ana.lopez@email.com', importeMensual: 1750, fechaInicio: '2024-04-01', fechaFin: '2025-04-01', estado: 'Activo' },
                    { inmuebleId: 5, nombreInquilino: 'Pedro S√°nchez Ruiz', dniInquilino: '56789012E', telefonoInquilino: '600555005', emailInquilino: 'pedro.sanchez@email.com', importeMensual: 750, fechaInicio: '2024-05-01', fechaFin: '2025-05-01', estado: 'Activo' },
                    { inmuebleId: 6, nombreInquilino: 'Laura D√≠az Moreno', dniInquilino: '67890123F', telefonoInquilino: '600666006', emailInquilino: 'laura.diaz@email.com', importeMensual: 2500, fechaInicio: '2024-06-01', fechaFin: '2025-06-01', estado: 'Activo' },
                    { inmuebleId: 7, nombreInquilino: 'Javier Mu√±oz Castro', dniInquilino: '78901234G', telefonoInquilino: '600777007', emailInquilino: 'javier.munoz@email.com', importeMensual: 1100, fechaInicio: '2024-07-01', fechaFin: '2025-07-01', estado: 'Activo' },
                    { inmuebleId: 8, nombreInquilino: 'Carmen Gil Romero', dniInquilino: '89012345H', telefonoInquilino: '600888008', emailInquilino: 'carmen.gil@email.com', importeMensual: 850, fechaInicio: '2024-08-01', fechaFin: '2025-08-01', estado: 'Activo' },
                    { inmuebleId: 9, nombreInquilino: 'Miguel Rubio Iglesias', dniInquilino: '90123456I', telefonoInquilino: '600999009', emailInquilino: 'miguel.rubio@email.com', importeMensual: 780, fechaInicio: '2024-09-01', fechaFin: '2025-09-01', estado: 'Activo' },
                    { inmuebleId: 10, nombreInquilino: 'Isabel Torres Santos', dniInquilino: '01234567J', telefonoInquilino: '601000010', emailInquilino: 'isabel.torres@email.com', importeMensual: 920, fechaInicio: '2024-10-01', fechaFin: '2025-10-01', estado: 'Activo' },
                    { inmuebleId: 11, nombreInquilino: 'Francisco Navarro Cano', dniInquilino: '11234567K', telefonoInquilino: '601111011', emailInquilino: 'francisco.navarro@email.com', importeMensual: 550, fechaInicio: '2024-11-01', fechaFin: '2025-11-01', estado: 'Activo' },
                    { inmuebleId: 12, nombreInquilino: 'Rosa Jim√©nez Vega', dniInquilino: '21234567L', telefonoInquilino: '601222012', emailInquilino: 'rosa.jimenez@email.com', importeMensual: 1050, fechaInicio: '2024-12-01', fechaFin: '2025-12-01', estado: 'Activo' }
                ];
                for (const a of alquileres) await agregarRegistro('alquileres', a);

                // 9. VENTAS (12 ejemplos)  
                const ventas = [
                    { inmuebleId: 1, comprador: 'Inversiones ABC SL', precioVenta: 285000, fechaVenta: '2024-03-15', notaria: 'Notar√≠a Garc√≠a M√°laga' },
                    { inmuebleId: 2, comprador: 'Roberto Fern√°ndez Cruz', precioVenta: 450000, fechaVenta: '2024-04-20', notaria: 'Notar√≠a L√≥pez Madrid' },
                    { inmuebleId: 3, comprador: 'Promotora Valencia SA', precioVenta: 380000, fechaVenta: '2024-05-10', notaria: 'Notar√≠a Mart√≠nez Valencia' },
                    { inmuebleId: 4, comprador: 'Elena Morales Ortiz', precioVenta: 520000, fechaVenta: '2024-06-05', notaria: 'Notar√≠a S√°nchez Barcelona' },
                    { inmuebleId: 5, comprador: 'Familia Ram√≠rez-G√≥mez', precioVenta: 195000, fechaVenta: '2024-07-12', notaria: 'Notar√≠a P√©rez Sevilla' },
                    { inmuebleId: 6, comprador: 'Luxury Homes International', precioVenta: 890000, fechaVenta: '2024-08-18', notaria: 'Notar√≠a Ruiz Marbella' },
                    { inmuebleId: 7, comprador: 'Alberto V√°zquez Prado', precioVenta: 320000, fechaVenta: '2024-09-22', notaria: 'Notar√≠a D√≠az Bilbao' },
                    { inmuebleId: 8, comprador: 'Marina Costa SL', precioVenta: 235000, fechaVenta: '2024-10-08', notaria: 'Notar√≠a √Ålvarez Alicante' },
                    { inmuebleId: 9, comprador: 'Silvia Romero Blanco', precioVenta: 185000, fechaVenta: '2024-11-15', notaria: 'Notar√≠a Torres Zaragoza' },
                    { inmuebleId: 10, comprador: 'Canarias Properties Group', precioVenta: 210000, fechaVenta: '2024-12-01', notaria: 'Notar√≠a Castro Gran Canaria' },
                    { inmuebleId: 11, comprador: 'Jacobo Camino Peregrino', precioVenta: 125000, fechaVenta: '2025-01-10', notaria: 'Notar√≠a Ramos A Coru√±a' },
                    { inmuebleId: 12, comprador: 'Loft Urban Invest', precioVenta: 295000, fechaVenta: '2025-02-14', notaria: 'Notar√≠a Herrera Valencia' }
                ];
                for (const v of ventas) await agregarRegistro('ventas', v);

                // 10. MOVIMIENTOS (12 ejemplos variados)
                const movimientos = [
                    { fecha: '2024-10-01', descripcion: 'Alquiler VIS-A101 Octubre', importe: 950, cuentaId: 1, categoriaId: 1, inmuebleId: 1, alquilerId: 1 },
                    { fecha: '2024-10-05', descripcion: 'Pago IBI VIS-A101', importe: -450, cuentaId: 1, categoriaId: 3, inmuebleId: 1 },
                    { fecha: '2024-10-01', descripcion: 'Alquiler TOR-B205 Octubre', importe: 1450, cuentaId: 2, categoriaId: 1, inmuebleId: 2, alquilerId: 2 },
                    { fecha: '2024-10-10', descripcion: 'Reparaci√≥n fontaner√≠a JAR-C303', importe: -285, cuentaId: 3, categoriaId: 6, inmuebleId: 3 },
                    { fecha: '2024-10-01', descripcion: 'Alquiler MAR-D104 Octubre', importe: 1750, cuentaId: 4, categoriaId: 1, inmuebleId: 4, alquilerId: 4 },
                    { fecha: '2024-10-15', descripcion: 'Seguro SEG-2024-006', importe: -1250, cuentaId: 5, categoriaId: 5, inmuebleId: 6 },
                    { fecha: '2024-10-01', descripcion: 'Alquiler SIE-G203 Octubre', importe: 1100, cuentaId: 7, categoriaId: 1, inmuebleId: 7, alquilerId: 7 },
                    { fecha: '2024-10-20', descripcion: 'Comunidad COS-H105', importe: -125, cuentaId: 8, categoriaId: 4, inmuebleId: 8 },
                    { fecha: '2024-10-01', descripcion: 'Alquiler URB-I301 Octubre', importe: 780, cuentaId: 9, categoriaId: 1, inmuebleId: 9, alquilerId: 9 },
                    { fecha: '2024-10-25', descripcion: 'Suministros PAL-J202', importe: -180, cuentaId: 10, categoriaId: 7, inmuebleId: 10 },
                    { fecha: '2024-10-01', descripcion: 'Alquiler CAM-K104 Octubre', importe: 550, cuentaId: 11, categoriaId: 1, inmuebleId: 11, alquilerId: 11 },
                    { fecha: '2024-10-30', descripcion: 'Comisi√≥n gesti√≥n TUR-L203', importe: -350, cuentaId: 12, categoriaId: 11, inmuebleId: 12 }
                ];
                for (const m of movimientos) await agregarRegistro('movimientos', m);

                // 11. EVENTOS (12 ejemplos)
                const eventos = [
                    { fecha: '2025-01-15', descripcion: 'Renovaci√≥n seguro VIS-A101', tipo: 'Vencimiento Seguro', inmuebleId: 1, importe: 380 },
                    { fecha: '2025-02-01', descripcion: 'Fin contrato TOR-B205', tipo: 'Vencimiento Alquiler', inmuebleId: 2, importe: 1450 },
                    { fecha: '2025-03-10', descripcion: 'Revisi√≥n caldera JAR-C303', tipo: 'Mantenimiento', inmuebleId: 3, importe: 85 },
                    { fecha: '2025-04-05', descripcion: 'Renovaci√≥n seguro MAR-D104', tipo: 'Vencimiento Seguro', inmuebleId: 4, importe: 890 },
                    { fecha: '2025-05-01', descripcion: 'Junta comunidad PLZ-E201', tipo: 'Junta Comunidad', inmuebleId: 5, importe: 0 },
                    { fecha: '2025-06-20', descripcion: 'ITP anual GOL-F102', tipo: 'Impuesto', inmuebleId: 6, importe: 1200 },
                    { fecha: '2025-07-08', descripcion: 'Inspecci√≥n ITE SIE-G203', tipo: 'Inspecci√≥n T√©cnica', inmuebleId: 7, importe: 250 },
                    { fecha: '2025-08-15', descripcion: 'Renovaci√≥n seguro COS-H105', tipo: 'Vencimiento Seguro', inmuebleId: 8, importe: 395 },
                    { fecha: '2025-09-01', descripcion: 'Fin garant√≠a lavadora URB-I301', tipo: 'Vencimiento Garant√≠a', inmuebleId: 9, importe: 0 },
                    { fecha: '2025-10-10', descripcion: 'Renovaci√≥n seguro PAL-J202', tipo: 'Vencimiento Seguro', inmuebleId: 10, importe: 365 },
                    { fecha: '2025-11-05', descripcion: 'Revisi√≥n gas CAM-K104', tipo: 'Mantenimiento', inmuebleId: 11, importe: 95 },
                    { fecha: '2025-12-01', descripcion: 'Fin contrato TUR-L203', tipo: 'Vencimiento Alquiler', inmuebleId: 12, importe: 1050 }
                ];
                for (const e of eventos) await agregarRegistro('eventos', e);

                console.log('‚úÖ Datos de prueba creados correctamente');
                mostrarNotificacion(`‚úÖ Datos de prueba creados exitosamente!\n\n` +
                      `üìä Se crearon 12 ejemplos para cada m√≥dulo:\n` +
                      `‚Ä¢ 12 Promociones\n` +
                      `‚Ä¢ 12 Inmuebles\n` +
                      `‚Ä¢ 12 Seguros\n` +
                      `‚Ä¢ 12 Garant√≠as\n` +
                      `‚Ä¢ 12 Ventas\n` +
                      `‚Ä¢ 12 Alquileres\n` +
                      `‚Ä¢ 12 Movimientos\n` +
                      `‚Ä¢ 12 Cuentas Bancarias\n` +
                      `‚Ä¢ 12 Categor√≠as\n` +
                      `‚Ä¢ 12 Comunidades\n` +
                      `‚Ä¢ 12 Eventos\n\n` +
                      `Total: 132 registros creados`, 'success');
                
                // Recargar dashboard y todas las secciones
                await cargarDashboard();
            } catch (error) {
                console.error('Error al crear datos de prueba:', error);
                mostrarNotificacion('‚ùå Error al crear datos de prueba: ' + error.message, 'error');
            }
        }

        // ============================================
        // INICIALIZACI√ìN
        // ============================================

        window.addEventListener('DOMContentLoaded', async () => {
            try {
                await initDB();
                await cargarDashboard();
                console.log('Aplicaci√≥n inicializada correctamente');
            } catch (error) {
                console.error('Error al inicializar la aplicaci√≥n:', error);
                mostrarNotificacion('Error al inicializar la base de datos');
            }
        });

        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker registrado correctamente:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Error al registrar Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>
